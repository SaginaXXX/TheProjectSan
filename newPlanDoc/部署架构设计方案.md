# æ ‘è“æ´¾å¤šå±å¹¿å‘Šç³»ç»Ÿ - éƒ¨ç½²æ¶æ„è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

åŸºäºæ ‘è“æ´¾çš„å¤šå±AIå¹¿å‘Šè½®æ’­ç³»ç»Ÿï¼Œæ”¯æŒå‰åç«¯åˆ†ç¦»ã€åŸŸåè®¿é—®ã€æ‰«ç ä¸Šä¼ å¹¿å‘Šï¼Œé€‚ç”¨äºå¤šå±å¹•å•†ä¸šåœºæ™¯ã€‚

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ‹“æ‰‘å›¾ï¼ˆå¤šç§Ÿæˆ·éš”ç¦»ç‰ˆï¼‰

```
                                 äº’è”ç½‘
                                   â†“
                           [åŸŸå: example.com]
                                   â†“
                          [Caddy åå‘ä»£ç† + è‡ªåŠ¨HTTPS]
                          /           |           \
                         /            |            \
                 å±å¹•1å‰ç«¯        å±å¹•2å‰ç«¯       å±å¹•3å‰ç«¯
              (å®¢æˆ·Aè®¿é—®)      (å®¢æˆ·Bè®¿é—®)     (å®¢æˆ·Cè®¿é—®)
                     â†“               â†“               â†“
              [åç«¯å®¹å™¨1]      [åç«¯å®¹å™¨2]      [åç«¯å®¹å™¨3]
              CLIENT_ID:       CLIENT_ID:       CLIENT_ID:
              screen1          screen2          screen3
              12393ç«¯å£        12394ç«¯å£        12395ç«¯å£
              å†…ç½®ä¸Šä¼ API      å†…ç½®ä¸Šä¼ API      å†…ç½®ä¸Šä¼ API
                     â†“               â†“               â†“
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
                             [S3å¯¹è±¡å­˜å‚¨ å•Bucket]
                             æŒ‰CLIENT_IDå‰ç¼€éš”ç¦»
                                     â†“
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â†“                   â†“                   â†“
         client_screen1/     client_screen2/     client_screen3/
         â”œâ”€â”€ ads/            â”œâ”€â”€ ads/            â”œâ”€â”€ ads/
         â””â”€â”€ agent/          â””â”€â”€ agent/          â””â”€â”€ agent/
             â”œâ”€â”€ images/         â”œâ”€â”€ images/         â”œâ”€â”€ images/
             â””â”€â”€ videos/         â””â”€â”€ videos/         â””â”€â”€ videos/
                     â†“                   â†“                   â†“
                 [CDNåŠ é€Ÿåˆ†å‘ (å¯é€‰)]
                     â†“                   â†“                   â†“
            [æ ‘è“æ´¾1æœ¬åœ°ç¼“å­˜] [æ ‘è“æ´¾2æœ¬åœ°ç¼“å­˜] [æ ‘è“æ´¾3æœ¬åœ°ç¼“å­˜]
            /cache/screen1/   /cache/screen2/   /cache/screen3/
                     â†“                   â†“                   â†“
            [Kioskå…¨å±æ˜¾ç¤º]   [Kioskå…¨å±æ˜¾ç¤º]   [Kioskå…¨å±æ˜¾ç¤º]
                     â†“                   â†“                   â†“
              [å¹¿å‘Šå±1]          [å¹¿å‘Šå±2]          [å¹¿å‘Šå±3]
             1920x1080         1920x1080         1920x1080
              å…¨å±æµè§ˆå™¨         å…¨å±æµè§ˆå™¨         å…¨å±æµè§ˆå™¨
```




---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡æ€è·¯

### 1. å‰åç«¯åˆ†ç¦»æ¶æ„

**ä¼˜åŠ¿**ï¼š
- âœ… **ç‹¬ç«‹æ‰©å±•**ï¼šå‰ç«¯å’Œåç«¯å¯ä»¥ç‹¬ç«‹å‡çº§ã€é‡å¯
- âœ… **è´Ÿè½½å‡è¡¡**ï¼šå‰ç«¯å¯ä»¥è¿æ¥å¤šä¸ªåç«¯å®ä¾‹
- âœ… **å¼€å‘æ•ˆç‡**ï¼šå‰åç«¯å›¢é˜Ÿå¯ä»¥å¹¶è¡Œå¼€å‘
- âœ… **èµ„æºä¼˜åŒ–**ï¼šé™æ€èµ„æºï¼ˆå‰ç«¯ï¼‰å¯ä»¥ç”¨CDNåŠ é€Ÿ

**å®ç°æ–¹å¼**ï¼š
```yaml
# docker-compose-screen1.yml
services:
  backend-screen1:
    image: theprojectsan-backend:latest
    ports:
      - "12393:12393"
    environment:
      # å®¢æˆ·æ ‡è¯†
      - CLIENT_ID=client_screen1
      - SCREEN_ID=screen1
      
      # å­˜å‚¨é…ç½®
      - STORAGE_TYPE=s3           # s3 æˆ– local
      - S3_BUCKET=your-ads-bucket
      - S3_REGION=us-east-1
      - S3_ACCESS_KEY=${AWS_ACCESS_KEY}
      - S3_SECRET_KEY=${AWS_SECRET_KEY}
      - CDN_URL=https://cdn.example.com
      
      # æœ¬åœ°ç¼“å­˜
      - CACHE_ENABLED=true
      - CACHE_DIR=/app/cache
    volumes:
      - ./conf-screen1.yaml:/app/conf.yaml:ro
      - /mnt/ssd/cache/client_screen1:/app/cache
      - /mnt/ssd/logs/screen1:/app/logs

  frontend-screen1:
    image: theprojectsan-frontend:latest
    ports:
      - "3000:3000"
    environment:
      - VITE_API_URL=http://backend-screen1:12393
      - VITE_CLIENT_ID=client_screen1
      - SCREEN_ID=screen1
```

---

### 2. å¤šå±å¹•ç‹¬ç«‹å®ä¾‹è®¾è®¡

**ä¸ºä»€ä¹ˆæ¯ä¸ªå±å¹•ç‹¬ç«‹éƒ¨ç½²ï¼Ÿ**

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **ç‹¬ç«‹å®ä¾‹** (æ¨è) | - æ•…éšœéš”ç¦»<br>- ç‹¬ç«‹é…ç½®<br>- æ€§èƒ½éš”ç¦» | - èµ„æºå ç”¨å¤š<br>- ç®¡ç†å¤æ‚ | **å•†ä¸šåœºæ™¯ï¼Œè¦æ±‚é«˜å¯ç”¨æ€§** |
| å…±äº«åç«¯ | - èµ„æºèŠ‚çœ<br>- ç»Ÿä¸€ç®¡ç† | - å•ç‚¹æ•…éšœ<br>- æ€§èƒ½ç“¶é¢ˆ | æµ‹è¯•ç¯å¢ƒæˆ–ä½è´Ÿè½½åœºæ™¯ |

**å…³é”®æ³¨æ„ç‚¹**ï¼š

#### âš ï¸ ç«¯å£è§„åˆ’
```bash
# å±å¹•1
Backend:  12393
Frontend: 3000
Nginx:    13001

# å±å¹•2
Backend:  12394
Frontend: 3001
Nginx:    13002

# å±å¹•3
Backend:  12395
Frontend: 3002
Nginx:    13003
```

#### âš ï¸ é…ç½®éš”ç¦»
```bash
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ docker-compose-screen1.yml
â”œâ”€â”€ docker-compose-screen2.yml
â”œâ”€â”€ docker-compose-screen3.yml
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ conf-screen1.yaml
â”‚   â”œâ”€â”€ conf-screen2.yaml
â”‚   â””â”€â”€ conf-screen3.yaml
â””â”€â”€ ads-storage/
    â”œâ”€â”€ screen1/
    â”œâ”€â”€ screen2/
    â””â”€â”€ screen3/
```

---

### 3. åŸŸåä¸åå‘ä»£ç†è®¾è®¡ï¼ˆä½¿ç”¨ Caddyï¼‰

**ä¸ºä»€ä¹ˆé€‰æ‹© Caddyï¼Ÿ**

| ç‰¹æ€§ | Caddy | Nginx | ä¼˜åŠ¿ |
|------|-------|-------|------|
| è‡ªåŠ¨HTTPS | âœ… å†…ç½® | âŒ éœ€è¦Certbot | **é›¶é…ç½®SSLè¯ä¹¦** |
| é…ç½®è¯­æ³• | âœ… ç®€å•ç›´è§‚ | âŒ å¤æ‚ | **æ˜“äºç»´æŠ¤** |
| HTTP/2 | âœ… é»˜è®¤å¯ç”¨ | âš ï¸ éœ€æ‰‹åŠ¨é…ç½® | **æ›´å¿«çš„æ€§èƒ½** |
| åå‘ä»£ç† | âœ… åŸç”Ÿæ”¯æŒ | âœ… æˆç†Ÿ | ä¸¤è€…ç›¸å½“ |
| WebSocket | âœ… è‡ªåŠ¨å¤„ç† | âš ï¸ éœ€é…ç½® | **æ›´ç®€å•** |

**Caddy é…ç½®æ–¹æ¡ˆ**ï¼š

```caddy
# /etc/caddy/Caddyfile

# å…¨å±€é…ç½®
{
    email admin@example.com
    # è‡ªåŠ¨HTTPS
    # è‡ªåŠ¨ç»­æœŸLet's Encryptè¯ä¹¦
}

# ç®¡ç†åå°
admin.example.com {
    # Portainerç®¡ç†ç•Œé¢
    reverse_proxy /portainer/* localhost:9443
    
    # ç›‘æ§é¢æ¿
    reverse_proxy /grafana/* localhost:3001
}

# å±å¹•1å‰ç«¯ï¼ˆKioskè®¿é—® + ä¸Šä¼ åŠŸèƒ½ï¼‰
screen1.example.com {
    # å‰ç«¯åº”ç”¨
    reverse_proxy localhost:3000
    
    # APIè¯·æ±‚ï¼ˆåŒ…æ‹¬ä¸Šä¼ ï¼‰è½¬å‘åˆ°åç«¯
    reverse_proxy /api/* localhost:12393 {
        # WebSocketæ”¯æŒï¼ˆè‡ªåŠ¨ï¼‰
        header_up Host {upstream_hostport}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
        header_up X-Client-ID client_screen1
        
        # ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶
        request_body {
            max_size 500MB
        }
    }
    
    # äº‘å­˜å‚¨CDNåŠ é€Ÿï¼ˆå¯é€‰ï¼‰
    reverse_proxy /cdn/* {
        to https://your-cdn.example.com
        header_down Access-Control-Allow-Origin *
    }
}

# å±å¹•2å‰ç«¯ï¼ˆKioskè®¿é—® + ä¸Šä¼ åŠŸèƒ½ï¼‰
screen2.example.com {
    reverse_proxy localhost:3001
    reverse_proxy /api/* localhost:12394 {
        header_up Host {upstream_hostport}
        header_up X-Real-IP {remote_host}
        header_up X-Client-ID client_screen2
        
        request_body {
            max_size 500MB
        }
    }
}

# å±å¹•3å‰ç«¯ï¼ˆKioskè®¿é—® + ä¸Šä¼ åŠŸèƒ½ï¼‰
screen3.example.com {
    reverse_proxy localhost:3002
    reverse_proxy /api/* localhost:12395 {
        header_up Host {upstream_hostport}
        header_up X-Real-IP {remote_host}
        header_up X-Client-ID client_screen3
        
        request_body {
            max_size 500MB
        }
    }
}

# CDNå›æºæœåŠ¡å™¨ï¼ˆå¯é€‰ï¼Œå¦‚æœä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼‰
cdn.example.com {
    root * /mnt/ssd/ads
    file_server browse
    
    # ç¼“å­˜æ§åˆ¶
    header Cache-Control "public, max-age=3600"
    
    # CORSæ”¯æŒ
    header Access-Control-Allow-Origin *
}
```

**Caddy Docker Compose é…ç½®**ï¼š

```yaml
# docker-compose-caddy.yml
services:
  caddy:
    image: caddy:latest
    ports:
      - "80:80"
      - "443:443"
      - "443:443/udp"  # HTTP/3æ”¯æŒ
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - caddy_data:/data
      - caddy_config:/config
      - /mnt/ssd/ads:/mnt/ssd/ads:ro  # åªè¯»æŒ‚è½½å¹¿å‘Šç›®å½•
    restart: unless-stopped
    networks:
      - ads-network

volumes:
  caddy_data:
  caddy_config:

networks:
  ads-network:
    external: true
```

**å­åŸŸåæ–¹æ¡ˆ**ï¼š
- `admin.example.com` â†’ ç®¡ç†åå°ï¼ˆPortainer + Grafanaï¼‰
- `screen1.example.com` â†’ å±å¹•1å‰ç«¯ï¼ˆKioskè®¿é—® + ä¸Šä¼ åŠŸèƒ½ï¼ŒCLIENT_ID=client_screen1ï¼‰
- `screen2.example.com` â†’ å±å¹•2å‰ç«¯ï¼ˆKioskè®¿é—® + ä¸Šä¼ åŠŸèƒ½ï¼ŒCLIENT_ID=client_screen2ï¼‰
- `screen3.example.com` â†’ å±å¹•3å‰ç«¯ï¼ˆKioskè®¿é—® + ä¸Šä¼ åŠŸèƒ½ï¼ŒCLIENT_ID=client_screen3ï¼‰
- `cdn.example.com` â†’ æœ¬åœ°CDNå›æºï¼ˆå¯é€‰ï¼ŒS3æ–¹æ¡ˆä¸éœ€è¦ï¼‰

**Caddy çš„ä¼˜åŠ¿æ€»ç»“**ï¼š
- âœ… **é›¶é…ç½®HTTPS**ï¼šè‡ªåŠ¨ç”³è¯·å’Œç»­æœŸSSLè¯ä¹¦
- âœ… **è‡ªåŠ¨HTTP/2å’ŒHTTP/3**ï¼šæ›´å¿«çš„åŠ è½½é€Ÿåº¦
- âœ… **ç®€æ´é…ç½®**ï¼š10è¡ŒCaddy = 50è¡ŒNginx
- âœ… **WebSocketå¼€ç®±å³ç”¨**ï¼šä¸éœ€è¦é¢å¤–é…ç½®
- âœ… **å†…ç½®é™æµå’Œå®‰å…¨**ï¼šé˜²æ­¢æ»¥ç”¨

---

### 4. æ‰«ç ä¸Šä¼ å¹¿å‘Šè®¾è®¡ï¼ˆäº‘å­˜å‚¨æ–¹æ¡ˆï¼‰

**æ¶æ„æµç¨‹ï¼ˆäº‘å­˜å‚¨ç‰ˆ + å¤šç§Ÿæˆ·éš”ç¦»ï¼‰**ï¼š

```
ç”¨æˆ·æ‰‹æœº
   â†“ (æ‰«ç )
[äºŒç»´ç : screen1.example.com/upload]
   â†“
[ç§»åŠ¨ç«¯ä¸Šä¼ é¡µé¢: è‡ªåŠ¨è¯†åˆ«CLIENT_ID]
   â†“ (é€‰æ‹©è§†é¢‘/å›¾ç‰‡)
[åç«¯ä¸Šä¼ API: /api/upload?category=ads]
   â†“ (éªŒè¯CLIENT_ID=client_screen1)
[éªŒè¯ + å‹ç¼© + æ ¼å¼è½¬æ¢]
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚S3äº‘å­˜å‚¨ï¼ˆæ¨èï¼‰        â”‚
â”‚- é˜¿é‡Œäº‘OSS            â”‚
â”‚- è…¾è®¯äº‘COS            â”‚
â”‚- AWS S3              â”‚
â”‚- Backblaze B2         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“ (å­˜å‚¨è·¯å¾„: client_screen1/ads/xxx.mp4)
[CDNåŠ é€Ÿåˆ†å‘]
   â†“
[æ ‘è“æ´¾é€šè¿‡HTTPSæ‹‰å–]
   â†“
[æœ¬åœ°ç¼“å­˜ (æŒ‰CLIENT_IDéš”ç¦»)]
   â†“
[Kioskæ¨¡å¼å…¨å±æ’­æ”¾]
```

**å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æˆæœ¬ | æ¨èåœºæ™¯ |
|------|------|------|------|----------|
| **äº‘å­˜å‚¨+CDN** | - æ— é™æ‰©å±•<br>- å…¨çƒåŠ é€Ÿ<br>- é«˜å¯ç”¨<br>- è‡ªåŠ¨å¤‡ä»½ | - éœ€è¦ä»˜è´¹<br>- ä¾èµ–ç½‘ç»œ | Â¥10-50/æœˆ | **ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰** |
| æœ¬åœ°å­˜å‚¨+NFS | - å…è´¹<br>- ä½å»¶è¿Ÿ | - å®¹é‡å—é™<br>- æ— å¤‡ä»½<br>- å•ç‚¹æ•…éšœ | Â¥0 | æµ‹è¯•ç¯å¢ƒ |
| MinIOè‡ªå»º | - å…¼å®¹S3<br>- è‡ªä¸»å¯æ§ | - éœ€è¦è¿ç»´<br>- å ç”¨èµ„æº | Â¥0ï¼ˆç¡¬ä»¶æˆæœ¬ï¼‰ | ä¸­ç­‰è§„æ¨¡ |

#### âš ï¸ äº‘å­˜å‚¨è®¾è®¡ï¼ˆæ¨èæ–¹æ¡ˆï¼‰

**é˜¿é‡Œäº‘OSSé…ç½®ç¤ºä¾‹**ï¼š

```python
# ä¸Šä¼ æœåŠ¡é…ç½®
import oss2

class CloudStorageService:
    def __init__(self):
        # OSSé…ç½®
        self.auth = oss2.Auth(
            access_key_id=os.getenv('OSS_ACCESS_KEY'),
            access_key_secret=os.getenv('OSS_SECRET_KEY')
        )
        self.bucket = oss2.Bucket(
            self.auth,
            'https://oss-cn-hangzhou.aliyuncs.com',
            'your-ads-bucket'
        )
        self.cdn_url = 'https://ads-cdn.example.com'
    
    async def upload_ad(self, screen_id: str, file: UploadFile):
        # ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
        filename = f"{screen_id}/{uuid4()}.mp4"
        
        # ä¸Šä¼ åˆ°OSS
        self.bucket.put_object(filename, file.file)
        
        # è¿”å›CDN URL
        return f"{self.cdn_url}/{filename}"
    
    def get_ad_list(self, screen_id: str):
        # åˆ—å‡ºæŒ‡å®šå±å¹•çš„æ‰€æœ‰å¹¿å‘Š
        return [obj.key for obj in self.bucket.list_objects(prefix=f"{screen_id}/").object_list]
```

**ä¸Šä¼ åŠŸèƒ½è¯´æ˜**ï¼š

ä¸Šä¼ æœåŠ¡å·²é›†æˆåœ¨åç«¯å®¹å™¨ä¸­ï¼ˆ`/api/upload` æ¥å£ï¼‰ï¼Œæ¯ä¸ªå±å¹•çš„åç«¯éƒ½æœ‰ç‹¬ç«‹çš„ä¸Šä¼ èƒ½åŠ›ï¼Œé€šè¿‡CLIENT_IDå®ç°èµ„æºéš”ç¦»ã€‚

```python
# åç«¯é›†æˆçš„ä¸Šä¼ æ¥å£ç¤ºä¾‹
@router.post("/api/upload")
async def upload_media(
    file: UploadFile,
    category: str = Query(..., regex="^(ads|agent)$"),  # adsæˆ–agent
    client_id: str = Query(None)  # å¯é€‰éªŒè¯
):
    # 1. è·å–å®¹å™¨çš„CLIENT_ID
    container_client_id = os.getenv('CLIENT_ID', 'default_client')
    
    # 2. éªŒè¯å®¢æˆ·ID
    if client_id and client_id != container_client_id:
        raise HTTPException(403, "å®¢æˆ·IDéªŒè¯å¤±è´¥")
    
    # 3. ä¸Šä¼ åˆ°S3: client_screen1/ads/xxx.mp4
    s3_key = f"{container_client_id}/{category}/{filename}"
    # ... ä¸Šä¼ é€»è¾‘
```

**åç«¯é…ç½®ç¤ºä¾‹ï¼ˆæ”¯æŒCLIENT_IDéš”ç¦»ï¼‰**ï¼š

```yaml
# conf-screen1.yaml
system_config:
  media_server:
    client_id: "client_screen1"  # å®¢æˆ·æ ‡è¯†
    storage_type: "s3"  # s3 æˆ– local
    
    # S3é…ç½®
    s3_bucket: "your-ads-bucket"
    s3_region: "us-east-1"
    cdn_url: "https://cdn.example.com"
    
    # æœ¬åœ°ç¼“å­˜ç­–ç•¥
    cache_enabled: true
    cache_dir: "/app/cache"
    cache_ttl: 3600  # ç¼“å­˜1å°æ—¶
    cache_size_limit: "10GB"
    
    # é¢„åŠ è½½ç­–ç•¥
    preload_enabled: true  # Kioskå¯åŠ¨æ—¶é¢„åŠ è½½å¹¿å‘Š
```

#### âš ï¸ æœ¬åœ°å­˜å‚¨è®¾è®¡ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰

```yaml
# å…±äº«å­˜å‚¨å· (NFSæˆ–æœ¬åœ°æŒ‚è½½)
volumes:
  shared-ads:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /mnt/ads-storage  # æ ‘è“æ´¾ä¸Šçš„SSDæˆ–ç§»åŠ¨ç¡¬ç›˜
```

**ä¸ºä»€ä¹ˆæ¨èäº‘å­˜å‚¨ï¼Ÿ**
- âœ… **æ— é™æ‰©å±•**ï¼šä¸å—æ ‘è“æ´¾å­˜å‚¨é™åˆ¶
- âœ… **CDNåŠ é€Ÿ**ï¼šå…¨çƒè®¿é—®æ›´å¿«
- âœ… **è‡ªåŠ¨å¤‡ä»½**ï¼šäº‘ç«¯å¤šå‰¯æœ¬å­˜å‚¨
- âœ… **æµé‡ä¼˜åŒ–**ï¼šæ™ºèƒ½ç¼“å­˜ï¼Œå‡å°‘é‡å¤ä¸‹è½½
- âœ… **æ˜“äºç®¡ç†**ï¼šWebæ§åˆ¶å°ç»Ÿä¸€ç®¡ç†

#### âš ï¸ äºŒç»´ç ç”Ÿæˆä¸åˆ†å‘æ–¹æ¡ˆï¼ˆå¤šç§Ÿæˆ·éš”ç¦»ï¼Œæ— éœ€ç™»å½•ï¼‰

**è®¾è®¡æ€è·¯**ï¼šæ— éœ€è´¦å·å¯†ç ç™»å½•ï¼Œæ¯ä¸ªå±å¹•æœ‰ç‹¬ç«‹çš„ä¸Šä¼ äºŒç»´ç ï¼Œæ‰«ç å³å¯ä¸Šä¼ èµ„æºåˆ°å¯¹åº”CLIENT_IDã€‚

##### æ–¹æ¡ˆä¸€ï¼šåç«¯APIè‡ªåŠ¨ç”ŸæˆäºŒç»´ç ï¼ˆæ¨èï¼‰

**1. åç«¯æ·»åŠ äºŒç»´ç ç”Ÿæˆæ¥å£**

```python
# src/ai_chat/routes.py - æ–°å¢æ¥å£
from qrcode import QRCode
from io import BytesIO
import base64

@router.get("/api/qrcode/upload")
async def get_upload_qrcode(category: str = "ads"):
    """
    è·å–å½“å‰å®¹å™¨çš„ä¸Šä¼ äºŒç»´ç 
    
    Args:
        category: ä¸Šä¼ ç±»åˆ« (ads=å¹¿å‘Š, agent=Agentèµ„æº)
    
    Returns:
        base64ç¼–ç çš„äºŒç»´ç å›¾ç‰‡
    """
    # è·å–å½“å‰å®¹å™¨çš„CLIENT_ID
    client_id = os.getenv('CLIENT_ID', 'default_client')
    
    # è·å–å½“å‰åŸŸåï¼ˆä»ç¯å¢ƒå˜é‡æˆ–é…ç½®ï¼‰
    domain = os.getenv('DOMAIN', 'screen1.example.com')
    
    # ç”Ÿæˆä¸Šä¼ URL
    upload_url = f"https://{domain}/upload?category={category}"
    
    # ç”ŸæˆäºŒç»´ç 
    qr = QRCode(version=1, box_size=10, border=5)
    qr.add_data(upload_url)
    qr.make(fit=True)
    
    img = qr.make_image(fill_color="black", back_color="white")
    
    # è½¬æ¢ä¸ºbase64
    buffer = BytesIO()
    img.save(buffer, format='PNG')
    img_base64 = base64.b64encode(buffer.getvalue()).decode()
    
    return {
        "client_id": client_id,
        "category": category,
        "upload_url": upload_url,
        "qrcode_base64": f"data:image/png;base64,{img_base64}",
        "display_text": f"æ‰«ç ä¸Šä¼ {category}èµ„æºåˆ° {client_id}"
    }
```

**2. å‰ç«¯æ˜¾ç¤ºäºŒç»´ç **

```typescript
// å‰ç«¯è·å–å¹¶æ˜¾ç¤ºäºŒç»´ç 
const QRCodeDisplay = () => {
  const [qrData, setQrData] = useState(null);
  
  useEffect(() => {
    // è·å–å¹¿å‘Šä¸Šä¼ äºŒç»´ç 
    fetch('/api/qrcode/upload?category=ads')
      .then(res => res.json())
      .then(data => setQrData(data));
  }, []);
  
  return (
    <div className="qrcode-container">
      {qrData && (
        <>
          <img src={qrData.qrcode_base64} alt="ä¸Šä¼ äºŒç»´ç " />
          <p>{qrData.display_text}</p>
          <p className="url">{qrData.upload_url}</p>
        </>
      )}
    </div>
  );
};
```

**3. å®¢æˆ·å¦‚ä½•è·å–äºŒç»´ç **

| æ–¹å¼ | é€‚ç”¨åœºæ™¯ | å®ç°æ–¹æ³• |
|------|---------|---------|
| **å±å¹•è§’è½æ˜¾ç¤º** | Kioskå¹¿å‘Šå± | å‰ç«¯é¡µé¢å³ä¸‹è§’å¸¸é©»æ˜¾ç¤ºäºŒç»´ç  |
| **ç®¡ç†åå°ä¸‹è½½** | è¿œç¨‹ç®¡ç† | Portainerç®¡ç†ç•Œé¢æä¾›äºŒç»´ç ä¸‹è½½ |
| **æ‰“å°è´´çº¸** | ç‰©ç†å±å¹•æ— | ç”Ÿæˆåæ‰“å°è´´åœ¨å±å¹•é™„è¿‘ |
| **APIç›´æ¥è®¿é—®** | å¼€å‘è°ƒè¯• | è®¿é—® `https://screen1.example.com/api/qrcode/upload` |

##### æ–¹æ¡ˆäºŒï¼šå‰ç«¯é¡µé¢å±•ç¤ºäºŒç»´ç ï¼ˆæ›´ç®€å•ï¼‰

**1. å‰ç«¯å†…ç½®äºŒç»´ç ç”Ÿæˆ**

```typescript
// ä½¿ç”¨ qrcode.react åº“
import QRCode from 'qrcode.react';

const UploadQRCode = () => {
  const clientId = import.meta.env.VITE_CLIENT_ID || 'client_screen1';
  const domain = window.location.hostname;
  const uploadUrl = `https://${domain}/upload?category=ads`;
  
  return (
    <div className="fixed bottom-4 right-4 bg-white p-4 rounded-lg shadow-lg">
      <h3 className="text-sm mb-2">æ‰«ç ä¸Šä¼ å¹¿å‘Š</h3>
      <QRCode 
        value={uploadUrl} 
        size={128}
        level="H"
      />
      <p className="text-xs mt-2 text-gray-600">{clientId}</p>
    </div>
  );
};
```

**2. é›†æˆåˆ°Kioské¡µé¢**

```typescript
// åœ¨Kioskä¸»ç•Œé¢æ˜¾ç¤ºäºŒç»´ç 
const KioskMainScreen = () => {
  return (
    <div className="kiosk-container">
      {/* å¹¿å‘Šè½®æ’­ */}
      <AdCarousel />
      
      {/* å³ä¸‹è§’æ˜¾ç¤ºä¸Šä¼ äºŒç»´ç  */}
      <UploadQRCode />
      
      {/* å¯é€‰ï¼šç‚¹å‡»æ˜¾ç¤ºAgentä¸Šä¼ äºŒç»´ç  */}
      <button onClick={() => setShowAgentQR(true)}>
        Agentèµ„æºä¸Šä¼ 
      </button>
    </div>
  );
};
```

##### æ–¹æ¡ˆä¸‰ï¼šé™æ€äºŒç»´ç å›¾ç‰‡ï¼ˆæœ€ç®€å•ï¼‰

**1. éƒ¨ç½²æ—¶é¢„å…ˆç”Ÿæˆ**

```bash
# éƒ¨ç½²è„šæœ¬ä¸­ç”ŸæˆäºŒç»´ç 
pip install qrcode[pil]

python3 << EOF
import qrcode

# ä¸ºæ¯ä¸ªå±å¹•ç”ŸæˆäºŒç»´ç 
screens = {
    "screen1": "https://screen1.example.com/upload?category=ads",
    "screen2": "https://screen2.example.com/upload?category=ads",
    "screen3": "https://screen3.example.com/upload?category=ads",
}

for screen_id, url in screens.items():
    qr = qrcode.QRCode(version=1, box_size=10, border=5)
    qr.add_data(url)
    qr.make(fit=True)
    img = qr.make_image(fill_color="black", back_color="white")
    img.save(f"/mnt/ssd/qrcodes/{screen_id}_upload.png")
    print(f"Generated QR code for {screen_id}")
EOF
```

**2. å‰ç«¯ç›´æ¥å¼•ç”¨é™æ€å›¾ç‰‡**

```typescript
// å‰ç«¯æ˜¾ç¤ºé¢„ç”Ÿæˆçš„äºŒç»´ç 
const StaticQRCode = () => {
  const clientId = import.meta.env.VITE_CLIENT_ID || 'client_screen1';
  
  return (
    <div className="qrcode-display">
      <img 
        src={`/qrcodes/${clientId}_upload.png`} 
        alt="ä¸Šä¼ äºŒç»´ç "
      />
    </div>
  );
};
```

##### æ¨èå®æ–½æ–¹æ¡ˆ

**æ··åˆæ–¹æ¡ˆï¼ˆæœ€ä½³ï¼‰**ï¼š

1. **å¼€å‘/æµ‹è¯•ç¯å¢ƒ**ï¼šä½¿ç”¨æ–¹æ¡ˆäºŒï¼ˆå‰ç«¯åŠ¨æ€ç”Ÿæˆï¼‰
   - çµæ´»ï¼Œæ— éœ€åç«¯æ”¯æŒ
   - å¯éšæ—¶åˆ‡æ¢category

2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨æ–¹æ¡ˆä¸‰ï¼ˆé™æ€å›¾ç‰‡ï¼‰+ æ–¹æ¡ˆä¸€ï¼ˆAPIå¤‡ç”¨ï¼‰
   - æ€§èƒ½å¥½ï¼Œä¸ä¾èµ–å®æ—¶ç”Ÿæˆ
   - APIæ¥å£ç”¨äºç®¡ç†åå°ä¸‹è½½

##### å®¢æˆ·è·å–äºŒç»´ç çš„å®Œæ•´æµç¨‹

```
éƒ¨ç½²é˜¶æ®µï¼š
    â†“
[ç®¡ç†å‘˜] éƒ¨ç½²æ¯ä¸ªå±å¹•æœåŠ¡
    â†“ (è‡ªåŠ¨ç”Ÿæˆ)
[ç³»ç»Ÿ] ç”Ÿæˆå¯¹åº”CLIENT_IDçš„äºŒç»´ç 
    â†“ (ä¸‰ç§æ–¹å¼)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–¹å¼1: Kioskå±å¹•å³ä¸‹è§’å¸¸é©»æ˜¾ç¤º          â”‚
â”‚ æ–¹å¼2: Portainerç®¡ç†åå°ä¸‹è½½            â”‚
â”‚ æ–¹å¼3: æ‰“å°è´´çº¸è´´åœ¨å±å¹•æ—               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[å®¢æˆ·] æ‰‹æœºæ‰«æäºŒç»´ç 
    â†“
[æµè§ˆå™¨] æ‰“å¼€ä¸Šä¼ é¡µé¢ï¼ˆè‡ªåŠ¨è¯†åˆ«CLIENT_IDï¼‰
    â†“
[å®¢æˆ·] é€‰æ‹©å›¾ç‰‡/è§†é¢‘ä¸Šä¼ 
    â†“
[åç«¯] éªŒè¯å¹¶ä¸Šä¼ åˆ° s3://bucket/client_screen1/ads/
    â†“
[æˆåŠŸ] æ˜¾ç¤ºä¸Šä¼ æˆåŠŸï¼Œèµ„æºå·²éš”ç¦»å­˜å‚¨
```

##### Docker Composeé…ç½®ç¤ºä¾‹

```yaml
# docker-compose-screen1.yml
services:
  backend-screen1:
    environment:
      - CLIENT_ID=client_screen1
      - DOMAIN=screen1.example.com  # ç”¨äºç”ŸæˆäºŒç»´ç 
      - STORAGE_TYPE=s3
    volumes:
      # æŒ‚è½½äºŒç»´ç ç›®å½•ï¼ˆå¦‚æœä½¿ç”¨é™æ€å›¾ç‰‡ï¼‰
      - ./qrcodes/screen1_upload.png:/app/frontend/public/qrcodes/upload.png:ro
```

##### ç®¡ç†åå°äºŒç»´ç ä¸‹è½½åŠŸèƒ½

```typescript
// Portaineræ‰©å±•æˆ–è‡ªå®šä¹‰ç®¡ç†é¡µé¢
const AdminQRCodePanel = () => {
  const screens = ['screen1', 'screen2', 'screen3'];
  
  const downloadQRCode = async (screenId) => {
    const response = await fetch(`/api/qrcode/upload?screen=${screenId}`);
    const data = await response.json();
    
    // ä¸‹è½½ä¸ºPNG
    const link = document.createElement('a');
    link.href = data.qrcode_base64;
    link.download = `${screenId}_upload_qrcode.png`;
    link.click();
  };
  
  return (
    <div className="qrcode-management">
      <h2>ä¸Šä¼ äºŒç»´ç ç®¡ç†</h2>
      {screens.map(screen => (
        <div key={screen} className="qrcode-item">
          <h3>{screen}</h3>
          <button onClick={() => downloadQRCode(screen)}>
            ä¸‹è½½äºŒç»´ç 
          </button>
          <button onClick={() => printQRCode(screen)}>
            æ‰“å°äºŒç»´ç 
          </button>
        </div>
      ))}
    </div>
  );
};
```

---

## ğŸ”’ å¤šç§Ÿæˆ·èµ„æºéš”ç¦»æ–¹æ¡ˆ

### è®¾è®¡ç›®æ ‡

ç¡®ä¿æ¯ä¸ªå®¢æˆ·çš„èµ„æºå®Œå…¨éš”ç¦»ï¼Œé¿å…ä¸åŒå±å¹•/å®¢æˆ·ä¹‹é—´çš„èµ„æºæ··æ·†ã€‚æœªæ¥Agentä¸Šä¼ çš„è§†é¢‘ã€å›¾ç‰‡ç­‰èµ„æºä¹Ÿèƒ½æŒ‰CLIENT_IDéš”ç¦»ã€‚

### å®¢æˆ·æ ‡è¯†ç³»ç»Ÿ

#### CLIENT_ID è®¾è®¡
- **æ ¼å¼**: `client_<screen_id>` æˆ–è‡ªå®šä¹‰åç§°
- **ç¤ºä¾‹**: `client_screen1`, `client_screen2`, `starbucks_beijing_01`
- **æ¯ä¸ªå±å¹•å¯¹åº”ä¸€ä¸ªç‹¬ç«‹å®¢æˆ·**ï¼Œå®Œå…¨éš”ç¦»èµ„æº

#### é…ç½®ç¤ºä¾‹

**docker-compose-screen1.yml**:
```yaml
services:
  backend-screen1:
    environment:
      - CLIENT_ID=client_screen1  # âœ… å®¢æˆ·æ ‡è¯†
      - STORAGE_TYPE=s3           # s3 æˆ– local
      - S3_BUCKET=your-ads-bucket
      - S3_REGION=us-east-1
      - S3_ACCESS_KEY=${AWS_ACCESS_KEY}
      - S3_SECRET_KEY=${AWS_SECRET_KEY}
      - CDN_URL=https://cdn.example.com
```

**conf-screen1.yaml**:
```yaml
system_config:
  media_server:
    client_id: "client_screen1"
    storage_type: "s3"  # s3 æˆ– local
    s3_bucket: "your-ads-bucket"
    s3_region: "us-east-1"
    cdn_url: "https://cdn.example.com"
```

### S3å­˜å‚¨æ–¹æ¡ˆï¼ˆæ¨èï¼‰

#### ä¸ºä»€ä¹ˆé€‰æ‹©S3ï¼Ÿ
- âœ… **æˆæœ¬å¯æ§**ï¼šå•Bucketæ–¹æ¡ˆçº¦Â¥5-20/æœˆ
- âœ… **æ— é™æ‰©å±•**ï¼šä¸å—æ ‘è“æ´¾å­˜å‚¨é™åˆ¶
- âœ… **è‡ªåŠ¨å¤‡ä»½**ï¼šäº‘ç«¯å¤šå‰¯æœ¬å­˜å‚¨
- âœ… **CDNåŠ é€Ÿ**ï¼šå…¨çƒè®¿é—®æ›´å¿«

#### å­˜å‚¨ç»“æ„ï¼ˆå•Bucket + å‰ç¼€éš”ç¦»ï¼‰

```
S3 Bucket: your-ads-bucket
â”œâ”€â”€ client_screen1/
â”‚   â”œâ”€â”€ ads/              # å¹¿å‘Šè§†é¢‘
â”‚   â”‚   â”œâ”€â”€ ad_001.mp4
â”‚   â”‚   â””â”€â”€ ad_002.mp4
â”‚   â””â”€â”€ agent/            # Agentä¸Šä¼ çš„èµ„æº
â”‚       â”œâ”€â”€ images/
â”‚       â”‚   â”œâ”€â”€ bg_01.jpg
â”‚       â”‚   â””â”€â”€ avatar_01.png
â”‚       â””â”€â”€ videos/
â”‚           â””â”€â”€ demo_01.mp4
â”œâ”€â”€ client_screen2/
â”‚   â”œâ”€â”€ ads/
â”‚   â””â”€â”€ agent/
â”‚       â”œâ”€â”€ images/
â”‚       â””â”€â”€ videos/
â””â”€â”€ client_screen3/
    â”œâ”€â”€ ads/
    â””â”€â”€ agent/
        â”œâ”€â”€ images/
        â””â”€â”€ videos/
```

#### è®¿é—®éš”ç¦»æœºåˆ¶

1. **ä¸Šä¼ éš”ç¦»**ï¼šåç«¯éªŒè¯CLIENT_IDï¼Œåªèƒ½ä¸Šä¼ åˆ°è‡ªå·±çš„å‰ç¼€
2. **è¯»å–éš”ç¦»**ï¼šAPIåªè¿”å›å½“å‰CLIENT_IDä¸‹çš„æ–‡ä»¶åˆ—è¡¨
3. **URLéš”ç¦»**ï¼šCDN URLåŒ…å«CLIENT_IDå‰ç¼€

```python
# ä¸Šä¼ ç¤ºä¾‹
POST /api/upload?category=agent&client_id=client_screen1
# â†’ å­˜å‚¨åˆ°: s3://your-bucket/client_screen1/agent/xxx.jpg

# åˆ—è¡¨ç¤ºä¾‹
GET /api/media/list?category=ads
# â†’ åªè¿”å›: s3://your-bucket/client_screen1/ads/* ä¸‹çš„æ–‡ä»¶
```

#### S3æœåŠ¡å•†æˆæœ¬å¯¹æ¯”

| æœåŠ¡å•† | å­˜å‚¨/GB/æœˆ | æµé‡/GB | æ€»æˆæœ¬(100GBå­˜å‚¨+20GBæµé‡) |
|--------|----------|--------|---------------------------|
| **é˜¿é‡Œäº‘OSS** | Â¥0.12 | Â¥0.50 | ~Â¥22/æœˆ |
| è…¾è®¯äº‘COS | Â¥0.11 | Â¥0.50 | ~Â¥21/æœˆ |
| **Backblaze B2 + Cloudflare** â­ | $0.005 | å…è´¹ | ~Â¥4/æœˆï¼ˆæœ€çœé’±ï¼‰|
| AWS S3 | $0.023 | $0.09 | ~Â¥25/æœˆ |

**æ¨èæ–¹æ¡ˆ**ï¼š
- **å›½å†…ç”¨æˆ·**ï¼šé˜¿é‡Œäº‘OSSï¼ˆé€Ÿåº¦å¿«ï¼‰
- **æˆæœ¬ä¼˜å…ˆ**ï¼šBackblaze B2 + Cloudflare CDNï¼ˆè¶…ä½æˆæœ¬ï¼‰

### æœ¬åœ°å­˜å‚¨æ–¹æ¡ˆï¼ˆå¤‡é€‰ï¼‰

å¦‚æœä¸ä½¿ç”¨S3ï¼Œæœ¬åœ°å­˜å‚¨ä¹Ÿéœ€è¦æŒ‰CLIENT_IDéš”ç¦»ï¼š

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ ads/
â”‚   â”œâ”€â”€ client_screen1/
â”‚   â”‚   â”œâ”€â”€ ad_01.mp4
â”‚   â”‚   â””â”€â”€ ad_02.mp4
â”‚   â”œâ”€â”€ client_screen2/
â”‚   â””â”€â”€ client_screen3/
â”œâ”€â”€ agent/                # Agentä¸Šä¼ çš„èµ„æº
â”‚   â”œâ”€â”€ client_screen1/
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ videos/
â”‚   â”œâ”€â”€ client_screen2/
â”‚   â””â”€â”€ client_screen3/
â””â”€â”€ cache/
    â”œâ”€â”€ client_screen1/
    â”œâ”€â”€ client_screen2/
    â””â”€â”€ client_screen3/
```

### æ•°æ®æµå‘ï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰

```
ç”¨æˆ·æ‰«ç ä¸Šä¼ 
    â†“
[ä¸Šä¼ é¡µé¢] screen1.example.com/upload
    â†“ (è‡ªåŠ¨æºå¸¦CLIENT_ID=client_screen1)
[åç«¯éªŒè¯] æ£€æŸ¥CLIENT_IDåŒ¹é…
    â†“ (éªŒè¯é€šè¿‡)
[æ–‡ä»¶éªŒè¯] ç±»å‹ã€å¤§å°ã€æ ¼å¼
    â†“
[S3ä¸Šä¼ ] â†’ s3://bucket/client_screen1/agent/image_123.jpg
    â†“
[è¿”å›URL] https://cdn.example.com/client_screen1/agent/image_123.jpg
    â†“
[å‰ç«¯æ˜¾ç¤º] ä»…æ˜¾ç¤ºclient_screen1çš„èµ„æº
    â†“
[Agentä½¿ç”¨] MCPå·¥å…·è°ƒç”¨è¯¥å›¾ç‰‡/è§†é¢‘
```

### å®‰å…¨ä¿è¯

- âœ… **ç¯å¢ƒå˜é‡éš”ç¦»**ï¼šæ¯ä¸ªå®¹å™¨æœ‰ç‹¬ç«‹çš„CLIENT_ID
- âœ… **APIéªŒè¯**ï¼šä¸Šä¼ æ—¶éªŒè¯CLIENT_IDåŒ¹é…
- âœ… **è·¯å¾„éš”ç¦»**ï¼šS3å‰ç¼€æˆ–æœ¬åœ°ç›®å½•å®Œå…¨åˆ†ç¦»
- âœ… **åˆ—è¡¨è¿‡æ»¤**ï¼šåªèƒ½æŸ¥çœ‹è‡ªå·±çš„èµ„æº
- âœ… **CDNéš”ç¦»**ï¼šURLåŒ…å«CLIENT_IDï¼Œæ— æ³•è·¨å®¢æˆ·è®¿é—®

---

### 5. Portainer å®¹å™¨ç®¡ç†

**éƒ¨ç½²æ€è·¯**ï¼š

```yaml
# docker-compose-portainer.yml
services:
  portainer:
    image: portainer/portainer-ce:latest
    ports:
      - "9443:9443"
      - "8000:8000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    restart: always
```

**Portainer ç®¡ç†ä¼˜åŠ¿**ï¼š
- âœ… **å¯è§†åŒ–ç®¡ç†**ï¼šä¸€é”®å¯åŠ¨/åœæ­¢/é‡å¯å®¹å™¨
- âœ… **æ—¥å¿—æŸ¥çœ‹**ï¼šå®æ—¶æŸ¥çœ‹æ¯ä¸ªå±å¹•çš„è¿è¡Œæ—¥å¿—
- âœ… **èµ„æºç›‘æ§**ï¼šCPUã€å†…å­˜ã€ç½‘ç»œæµé‡ç›‘æ§
- âœ… **è¿œç¨‹è®¿é—®**ï¼šé€šè¿‡åŸŸåè¿œç¨‹ç®¡ç†æ ‘è“æ´¾

**Portainer Stacks ç®¡ç†**ï¼š
```
Stacks (åº”ç”¨æ ˆ):
â”œâ”€â”€ screen1-stack (docker-compose-screen1.yml) - CLIENT_ID=client_screen1
â”œâ”€â”€ screen2-stack (docker-compose-screen2.yml) - CLIENT_ID=client_screen2
â”œâ”€â”€ screen3-stack (docker-compose-screen3.yml) - CLIENT_ID=client_screen3
â”œâ”€â”€ caddy-stack   (docker-compose-caddy.yml)   - åå‘ä»£ç†
â””â”€â”€ portainer-stack (docker-compose-portainer.yml) - å®¹å™¨ç®¡ç†
```

**è¯´æ˜**ï¼šä¸Šä¼ åŠŸèƒ½å·²é›†æˆåœ¨å„ä¸ªscreençš„åç«¯å®¹å™¨ä¸­ï¼Œæ— éœ€ç‹¬ç«‹éƒ¨ç½²ã€‚

---

### 6. Kiosk å¹¿å‘Šå±æ¨¡å¼è®¾è®¡

**ä»€ä¹ˆæ˜¯Kioskæ¨¡å¼ï¼Ÿ**
- æ ‘è“æ´¾å¯åŠ¨å**è‡ªåŠ¨å…¨å±æ‰“å¼€æµè§ˆå™¨**
- **ç¦æ­¢é€€å‡º**å…¨å±æ¨¡å¼
- **è‡ªåŠ¨æ¢å¤**ï¼šæ–­ç”µé‡å¯åè‡ªåŠ¨æ‰“å¼€
- **è¿œç¨‹ç®¡ç†**ï¼šæ— éœ€ç‰©ç†æ¥è§¦è®¾å¤‡

**Kioskæ¶æ„æ–¹æ¡ˆ**ï¼š

```
æ ‘è“æ´¾å¯åŠ¨
    â†“
[Raspberry Pi OS Lite] (æ— æ¡Œé¢ï¼Œæ›´è½»é‡)
    â†“
[X Server] (å›¾å½¢æœåŠ¡å™¨)
    â†“
[Openbox] (è½»é‡çº§çª—å£ç®¡ç†å™¨)
    â†“
[Chromiumæµè§ˆå™¨] (Kioskæ¨¡å¼)
    â†“
åŠ è½½: https://screen1.example.com
    â†“
[å…¨å±å¹¿å‘Šè½®æ’­ç•Œé¢]
```

#### ğŸ”§ Kiosk é…ç½®æ­¥éª¤

**æ­¥éª¤1: å®‰è£…å¿…è¦è½¯ä»¶**

```bash
# SSHè¿æ¥åˆ°æ ‘è“æ´¾åæ‰§è¡Œ
sudo apt update
sudo apt install -y \
    xserver-xorg \
    x11-xserver-utils \
    xinit \
    openbox \
    chromium-browser \
    unclutter  # éšè—é¼ æ ‡æŒ‡é’ˆ
```

**æ­¥éª¤2: åˆ›å»ºKioskå¯åŠ¨è„šæœ¬**

```bash
# /home/pi/kiosk.sh
#!/bin/bash

# å…³é—­å±å¹•ä¿æŠ¤å’ŒèŠ‚èƒ½
xset s off
xset -dpms
xset s noblank

# éšè—é¼ æ ‡æŒ‡é’ˆ
unclutter -idle 0.1 &

# å¯åŠ¨Chromiumæµè§ˆå™¨ï¼ˆKioskæ¨¡å¼ï¼‰
chromium-browser \
    --kiosk \
    --noerrdialogs \
    --disable-infobars \
    --no-first-run \
    --enable-features=OverlayScrollbar \
    --disable-pinch \
    --overscroll-history-navigation=0 \
    --check-for-update-interval=31536000 \
    --disable-restore-session-state \
    --disable-session-crashed-bubble \
    --app=https://screen1.example.com
```

**æ­¥éª¤3: é…ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨**

```bash
# /home/pi/.config/openbox/autostart
# Kioskå¯åŠ¨è„šæœ¬
bash /home/pi/kiosk.sh &
```

**æ­¥éª¤4: é…ç½®è‡ªåŠ¨ç™»å½•å’Œå¯åŠ¨X**

```bash
# ç¼–è¾‘: /etc/systemd/system/getty@tty1.service.d/autologin.conf
[Service]
ExecStart=
ExecStart=-/sbin/agetty --autologin pi --noclear %I $TERM
Type=idle

# ç¼–è¾‘: /home/pi/.bash_profile
if [ -z "$DISPLAY" ] && [ $(tty) = /dev/tty1 ]; then
    startx -- -nocursor
fi
```

**æ­¥éª¤5: é…ç½®Openboxçª—å£ç®¡ç†å™¨**

```bash
# /home/pi/.config/openbox/rc.xml
<?xml version="1.0"?>
<openbox_config>
  <applications>
    <application class="Chromium-browser">
      <fullscreen>yes</fullscreen>
      <maximized>yes</maximized>
    </application>
  </applications>
</openbox_config>
```

#### ğŸ¯ Kiosk é«˜çº§åŠŸèƒ½

**1. è‡ªåŠ¨é‡å¯æµè§ˆå™¨ï¼ˆé˜²æ­¢å´©æºƒï¼‰**

```bash
# /home/pi/kiosk-watchdog.sh
#!/bin/bash
while true; do
    if ! pgrep -x "chromium-browse" > /dev/null; then
        echo "Chromium crashed, restarting..."
        bash /home/pi/kiosk.sh &
    fi
    sleep 10
done
```

**2. è¿œç¨‹æ§åˆ¶Kiosk**

```yaml
# docker-compose-kiosk-manager.yml
services:
  kiosk-manager:
    image: kiosk-manager:latest
    ports:
      - "8888:8888"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - KIOSK_URL=https://screen1.example.com
    
    # åŠŸèƒ½ï¼š
    # - è¿œç¨‹åˆ·æ–°é¡µé¢
    # - è¿œç¨‹é‡å¯æµè§ˆå™¨
    # - è¿œç¨‹æ›´æ–°é…ç½®
    # - è¿œç¨‹æˆªå›¾æŸ¥çœ‹å½“å‰çŠ¶æ€
```

**3. å®šæ—¶åˆ·æ–°é¡µé¢ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰**

```bash
# æ¯å¤©å‡Œæ™¨3ç‚¹é‡å¯æµè§ˆå™¨
# crontab -e
0 3 * * * pkill chromium && bash /home/pi/kiosk.sh
```

**4. å¤šå±å¹•æ”¯æŒ**

```bash
# å¦‚æœæ ‘è“æ´¾è¿æ¥å¤šä¸ªæ˜¾ç¤ºå™¨
xrandr --output HDMI-1 --mode 1920x1080 --rotate normal
xrandr --output HDMI-2 --mode 1920x1080 --rotate normal --right-of HDMI-1

# åœ¨ä¸åŒæ˜¾ç¤ºå™¨ä¸Šæ‰“å¼€ä¸åŒURL
DISPLAY=:0.0 chromium --kiosk https://screen1.example.com &
DISPLAY=:0.1 chromium --kiosk https://screen2.example.com &
```

#### âš ï¸ Kiosk æ¨¡å¼æ³¨æ„äº‹é¡¹

**æ€§èƒ½ä¼˜åŒ–**ï¼š
```bash
# ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡
sudo systemctl disable bluetooth
sudo systemctl disable wifi
sudo systemctl disable triggerhappy

# å¢åŠ GPUå†…å­˜ï¼ˆç¼–è¾‘ /boot/config.txtï¼‰
gpu_mem=256  # ç»™GPUæ›´å¤šå†…å­˜ï¼Œæå‡è§†é¢‘æ’­æ”¾æ€§èƒ½
```

**ç½‘ç»œå®¹é”™**ï¼š
```bash
# ç½‘ç»œæ–­çº¿æ—¶æ˜¾ç¤ºç¦»çº¿é¡µé¢
chromium-browser \
    --kiosk \
    --app=https://screen1.example.com \
    --app-auto-launched \
    --disable-features=TranslateUI \
    --enable-features=NetworkService,NetworkServiceInProcess
```

**å®‰å…¨åŠ å›º**ï¼š
```bash
# ç¦ç”¨è§¦æ‘¸å±è¾“å…¥ï¼ˆé˜²æ­¢è¢«ç”¨æˆ·æ“ä½œï¼‰
xinput disable "Touch Screen"

# ç¦ç”¨é”®ç›˜å¿«æ·é”®
# åœ¨Chromiumå¯åŠ¨å‚æ•°ä¸­æ·»åŠ ï¼š
--disable-features=GlobalMediaControls
```

#### ğŸ“± Kiosk ç®¡ç†Webç•Œé¢ï¼ˆå¯é€‰ï¼‰

```html
<!-- ç®¡ç†åå°åŠŸèƒ½ -->
https://admin.example.com/kiosk-manager

åŠŸèƒ½åˆ—è¡¨:
- ğŸ“Š æŸ¥çœ‹æ‰€æœ‰Kioskè®¾å¤‡çŠ¶æ€
- ğŸ”„ è¿œç¨‹åˆ·æ–°é¡µé¢
- ğŸ–¼ï¸ è¿œç¨‹æˆªå›¾
- âš™ï¸ ä¿®æ”¹å¯åŠ¨URL
- ğŸ”§ é‡å¯è®¾å¤‡
- ğŸ“ˆ è®¾å¤‡å¥åº·ç›‘æ§ï¼ˆCPU/å†…å­˜/ç½‘ç»œï¼‰
```

**DockeråŒ–Kioskç®¡ç†æœåŠ¡**ï¼š

```yaml
# docker-compose-kiosk-control.yml
services:
  kiosk-control:
    image: kiosk-control:latest
    ports:
      - "8888:8888"
    environment:
      - DEVICES=screen1,screen2,screen3
      - SCREEN1_IP=192.168.1.101
      - SCREEN2_IP=192.168.1.102
      - SCREEN3_IP=192.168.1.103
    
    # SSHè¿æ¥åˆ°æ¯å°æ ‘è“æ´¾è¿›è¡Œæ§åˆ¶
    volumes:
      - ./ssh-keys:/root/.ssh:ro
```

---

## ğŸš¨ å…³é”®æ³¨æ„äº‹é¡¹

### 1. æ ‘è“æ´¾ç¡¬ä»¶èµ„æºé™åˆ¶

| èµ„æº | å•å±å¹•éœ€æ±‚ | ä¸‰å±å¹•éœ€æ±‚ | æ ‘è“æ´¾4 8GB | ç»“è®º |
|------|-----------|-----------|-------------|------|
| CPU | 1æ ¸ | 3æ ¸ | 4æ ¸ | âœ… è¶³å¤Ÿ |
| å†…å­˜ | 1.5GB | 4.5GB | 8GB | âœ… è¶³å¤Ÿ |
| å­˜å‚¨ | 10GB | 30GB + å¹¿å‘Šå­˜å‚¨ | éœ€è¦å¤–æ¥SSD | âš ï¸ éœ€è¦æ‰©å±• |
| ç½‘ç»œ | 10Mbps | 30Mbps | 1Gbps | âœ… è¶³å¤Ÿ |

**ä¼˜åŒ–å»ºè®®**ï¼š
```yaml
# é™åˆ¶æ¯ä¸ªå®¹å™¨çš„èµ„æºä½¿ç”¨
services:
  backend-screen1:
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1.5G
        reservations:
          cpus: '0.5'
          memory: 512M
```

---

### 2. ç½‘ç»œè®¾è®¡

**Dockerç½‘ç»œæ¨¡å¼é€‰æ‹©**ï¼š

```yaml
# åˆ›å»ºä¸“ç”¨ç½‘ç»œï¼Œæé«˜å®‰å…¨æ€§
networks:
  ads-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16

services:
  backend-screen1:
    networks:
      ads-network:
        ipv4_address: 172.20.1.10
  
  frontend-screen1:
    networks:
      ads-network:
        ipv4_address: 172.20.1.11
```

**ä¸ºä»€ä¹ˆéœ€è¦ä¸“ç”¨ç½‘ç»œï¼Ÿ**
- âœ… å®¹å™¨é—´é€šä¿¡ä¸èµ°å®¿ä¸»æœºç½‘ç»œ
- âœ… å›ºå®šIPï¼Œæ–¹ä¾¿é…ç½®
- âœ… å®‰å…¨éš”ç¦»

---

### 3. æ•°æ®æŒä¹…åŒ–ç­–ç•¥ï¼ˆäº‘å­˜å‚¨ç‰ˆï¼‰

**äº‘å­˜å‚¨æ–¹æ¡ˆï¼ˆæ¨èï¼Œæ”¯æŒCLIENT_IDéš”ç¦»ï¼‰**ï¼š

```yaml
# docker-compose-screen1.yml
services:
  backend-screen1:
    environment:
      # å®¢æˆ·æ ‡è¯†ï¼ˆå¤šç§Ÿæˆ·éš”ç¦»ï¼‰
      - CLIENT_ID=client_screen1
      
      # äº‘å­˜å‚¨é…ç½®
      - STORAGE_TYPE=s3  # s3/oss/cos
      - S3_BUCKET=your-ads-bucket
      - S3_REGION=us-east-1
      - S3_ACCESS_KEY=${AWS_ACCESS_KEY}
      - S3_SECRET_KEY=${AWS_SECRET_KEY}
      - CDN_URL=https://cdn.example.com
      
      # æœ¬åœ°ç¼“å­˜é…ç½®
      - CACHE_ENABLED=true
      - CACHE_DIR=/app/cache
      - CACHE_SIZE_LIMIT=10GB  # æœ¬åœ°ç¼“å­˜æœ€å¤§10GB
      
    volumes:
      # ä»…ç¼“å­˜å’Œæ—¥å¿—éœ€è¦æŒä¹…åŒ–ï¼ˆæŒ‰CLIENT_IDéš”ç¦»ï¼‰
      - /mnt/ssd/cache/client_screen1:/app/cache
      - /mnt/ssd/logs/screen1:/app/logs
      
      # é…ç½®æ–‡ä»¶
      - ./conf-screen1.yaml:/app/conf.yaml:ro
```

**æœ¬åœ°å­˜å‚¨æ–¹æ¡ˆï¼ˆå¤‡é€‰ï¼Œå¿…é¡»æŒ‰CLIENT_IDéš”ç¦»ï¼‰**ï¼š

```yaml
volumes:
  # å¹¿å‘Šè§†é¢‘ï¼ˆæŒ‰CLIENT_IDéš”ç¦»ï¼‰
  - /mnt/ssd/ads/client_screen1:/app/ads/client_screen1
  
  # Agentèµ„æºï¼ˆæŒ‰CLIENT_IDéš”ç¦»ï¼‰
  - /mnt/ssd/agent/client_screen1:/app/agent/client_screen1
  
  # é…ç½®æ–‡ä»¶
  - ./conf-screen1.yaml:/app/conf.yaml:ro  # åªè¯»æŒ‚è½½
  
  # ç¼“å­˜
  - /mnt/ssd/cache/client_screen1:/app/cache
  
  # æ—¥å¿—
  - /mnt/ssd/logs/screen1:/app/logs
  
  # èŠå¤©å†å²
  - /mnt/ssd/chat_history/screen1:/app/chat_history
```

**å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | æ ‘è“æ´¾å­˜å‚¨éœ€æ±‚ | æ‰©å±•æ€§ | å¤‡ä»½ | æ¨è |
|------|---------------|-------|------|------|
| **äº‘å­˜å‚¨+æœ¬åœ°ç¼“å­˜** | 10-20GBç¼“å­˜ | âœ… æ— é™ | âœ… è‡ªåŠ¨ | â­â­â­â­â­ |
| å¤–æ¥SSD | 500GB-1TB | âš ï¸ æœ‰é™ | âŒ éœ€æ‰‹åŠ¨ | â­â­â­ |
| NFSç½‘ç»œå­˜å‚¨ | 0 (å…¨ç½‘ç»œ) | âœ… è¾ƒå¥½ | âš ï¸ çœ‹æœåŠ¡å™¨ | â­â­â­ |
| SDå¡ | - | âŒ æå·® | âŒ æ—  | âŒ ä¸æ¨è |

**äº‘å­˜å‚¨ä¼˜åŠ¿æ€»ç»“**ï¼š
- âœ… **æ ‘è“æ´¾åªéœ€10-20GBç¼“å­˜**ï¼Œä¸éœ€è¦å¤§å®¹é‡å­˜å‚¨
- âœ… **è‡ªåŠ¨CDNåˆ†å‘**ï¼Œè®¿é—®é€Ÿåº¦æ›´å¿«
- âœ… **äº‘ç«¯è‡ªåŠ¨å¤‡ä»½**ï¼Œä¸æ€•æ•°æ®ä¸¢å¤±
- âœ… **å¤©ç„¶å¤šç§Ÿæˆ·éš”ç¦»**ï¼Œé€šè¿‡S3å‰ç¼€å®ç°å®¢æˆ·èµ„æºéš”ç¦»
- âœ… **æ˜“äºæ‰©å±•**ï¼Œä¸å—å•å°è®¾å¤‡å­˜å‚¨é™åˆ¶
- âœ… **æˆæœ¬å¯æ§**ï¼ŒæŒ‰å®é™…ä½¿ç”¨é‡ä»˜è´¹ï¼ˆçº¦Â¥5-20/æœˆï¼‰

---

### 4. æ•…éšœéš”ç¦»ä¸æ¢å¤

**è®¾è®¡åŸåˆ™**ï¼š
```yaml
# è‡ªåŠ¨é‡å¯ç­–ç•¥
services:
  backend-screen1:
    restart: unless-stopped  # é™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™æ€»æ˜¯é‡å¯
    
    # å¥åº·æ£€æŸ¥
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:12393/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
```

**æ•…éšœå½±å“èŒƒå›´**ï¼š
- å±å¹•1åç«¯å´©æºƒ â†’ âŒ åªå½±å“å±å¹•1
- å±å¹•2åç«¯å´©æºƒ â†’ âŒ åªå½±å“å±å¹•2
- ä¸Šä¼ æœåŠ¡å´©æºƒ â†’ âŒ åªå½±å“ä¸Šä¼ åŠŸèƒ½ï¼Œæ’­æ”¾ä¸å—å½±å“
- Nginxå´©æºƒ â†’ âŒ å½±å“æ‰€æœ‰å±å¹•ï¼ˆå•ç‚¹æ•…éšœï¼‰

**å¦‚ä½•é¿å…Nginxå•ç‚¹æ•…éšœï¼Ÿ**
- ä½¿ç”¨Nginxçš„å¤‡ä»½æœºåˆ¶
- æˆ–è€…ä½¿ç”¨äº‘æœåŠ¡å•†çš„è´Ÿè½½å‡è¡¡å™¨

---

### 5. åŸŸåä¸SSLè¯ä¹¦ï¼ˆCaddyè‡ªåŠ¨åŒ–ï¼‰

**Caddyçš„é›¶é…ç½®HTTPS**ï¼š

Caddyä¼šè‡ªåŠ¨ï¼š
1. âœ… æ£€æµ‹åŸŸå
2. âœ… å‘Let's Encryptç”³è¯·è¯ä¹¦
3. âœ… è‡ªåŠ¨ç»­æœŸï¼ˆåˆ°æœŸå‰30å¤©ï¼‰
4. âœ… è‡ªåŠ¨é‡å®šå‘HTTPåˆ°HTTPS

**æ— éœ€ä»»ä½•æ‰‹åŠ¨æ“ä½œï¼**

```yaml
# docker-compose-caddy.yml
services:
  caddy:
    image: caddy:latest
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - caddy_data:/data  # è¯ä¹¦è‡ªåŠ¨å­˜å‚¨åœ¨è¿™é‡Œ
      - caddy_config:/config
    restart: unless-stopped
```

**è¯ä¹¦å­˜å‚¨ä½ç½®**ï¼š
```bash
# Caddyä¼šè‡ªåŠ¨å°†è¯ä¹¦å­˜å‚¨åœ¨Dockerå·ä¸­
/data/caddy/certificates/acme-v02.api.letsencrypt.org-directory/
  â”œâ”€â”€ screen1.example.com/
  â”‚   â”œâ”€â”€ screen1.example.com.crt
  â”‚   â””â”€â”€ screen1.example.com.key
  â”œâ”€â”€ screen2.example.com/
  â””â”€â”€ upload.example.com/
```

**åŸŸåè§£ææ–¹æ¡ˆ**ï¼š

| åœºæ™¯ | è§£å†³æ–¹æ¡ˆ | é…ç½® |
|------|---------|------|
| **å…¬ç½‘IP** | ç›´æ¥è§£æ | Aè®°å½•æŒ‡å‘æ ‘è“æ´¾å…¬ç½‘IP |
| **å†…ç½‘IP** | ç«¯å£è½¬å‘ | è·¯ç”±å™¨NATé…ç½® |
| **åŠ¨æ€IP** | DDNSæœåŠ¡ | ä½¿ç”¨é˜¿é‡Œäº‘DDNS / No-IP |
| **æ— å…¬ç½‘IP** | å†…ç½‘ç©¿é€ | frp / Cloudflare Tunnel |

**æ¨èæ–¹æ¡ˆï¼šCloudflare Tunnelï¼ˆé›¶é…ç½®å†…ç½‘ç©¿é€ï¼‰**

```yaml
# docker-compose-cloudflare.yml
services:
  cloudflared:
    image: cloudflare/cloudflared:latest
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${CF_TUNNEL_TOKEN}
    restart: unless-stopped
    network_mode: host
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ— éœ€å…¬ç½‘IP
- âœ… æ— éœ€ç«¯å£è½¬å‘
- âœ… è‡ªåŠ¨HTTPS
- âœ… DDoSé˜²æŠ¤
- âœ… å…è´¹ä½¿ç”¨

---

### 6. æ€§èƒ½ä¼˜åŒ–

**å‰ç«¯ä¼˜åŒ–**ï¼š
```yaml
# å‰ç«¯å®¹å™¨ä½¿ç”¨ç”Ÿäº§æ„å»º
services:
  frontend-screen1:
    build:
      context: ./frontend
      dockerfile: Dockerfile.prod  # ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒDockerfile
      args:
        - NODE_ENV=production
    environment:
      - VITE_API_URL=http://backend-screen1:12393
```

**åç«¯ä¼˜åŒ–**ï¼š
```yaml
# åç«¯ä½¿ç”¨uvicornå¤šworker
services:
  backend-screen1:
    command: uvicorn src.ai_chat.server:app --host 0.0.0.0 --port 12393 --workers 2
```

**ç¼“å­˜ç­–ç•¥**ï¼š
- å¹¿å‘Šè§†é¢‘ç¼“å­˜åœ¨æœ¬åœ°ï¼Œé¿å…é‡å¤ä¸‹è½½
- TTSéŸ³é¢‘ç¼“å­˜åœ¨Redisï¼ˆå¯é€‰ï¼‰
- Live2Dæ¨¡å‹é¢„åŠ è½½

---

### 7. ç›‘æ§ä¸æ—¥å¿—

**æ¨èç›‘æ§æ–¹æ¡ˆ**ï¼š

```yaml
# docker-compose-monitoring.yml
services:
  # Prometheus (æŒ‡æ ‡æ”¶é›†)
  prometheus:
    image: prom/prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"
  
  # Grafana (å¯è§†åŒ–ä»ªè¡¨ç›˜)
  grafana:
    image: grafana/grafana
    ports:
      - "3001:3000"
    depends_on:
      - prometheus
  
  # Loki (æ—¥å¿—æ”¶é›†)
  loki:
    image: grafana/loki
    ports:
      - "3100:3100"
```

**ç›‘æ§æŒ‡æ ‡**ï¼š
- CPU/å†…å­˜ä½¿ç”¨ç‡
- å¹¿å‘Šæ’­æ”¾æ¬¡æ•°
- ç”¨æˆ·å¯¹è¯æ¬¡æ•°
- å®¹å™¨é‡å¯æ¬¡æ•°
- ä¸Šä¼ æˆåŠŸ/å¤±è´¥æ¬¡æ•°

---

## ğŸ”„ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±• (å¢åŠ å±å¹•)

**æ­¥éª¤**ï¼š
1. å¤åˆ¶ `docker-compose-screen1.yml` â†’ `docker-compose-screen4.yml`
2. ä¿®æ”¹ç«¯å£å·ï¼ˆé¿å…å†²çªï¼‰
3. åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶ `conf-screen4.yaml`
4. åœ¨Nginxä¸­æ·»åŠ æ–°çš„serverå—
5. ç”Ÿæˆæ–°çš„ä¸Šä¼ äºŒç»´ç 

**è‡ªåŠ¨åŒ–è„šæœ¬**ï¼š
```bash
#!/bin/bash
# add-screen.sh
SCREEN_ID=$1
BACKEND_PORT=$((12393 + SCREEN_ID - 1))
FRONTEND_PORT=$((3000 + SCREEN_ID - 1))

# ç”Ÿæˆdocker-composeæ–‡ä»¶
cat > docker-compose-screen${SCREEN_ID}.yml <<EOF
services:
  backend-screen${SCREEN_ID}:
    ...
    ports:
      - "${BACKEND_PORT}:12393"
  ...
EOF

echo "æ–°å±å¹•å·²åˆ›å»º: screen${SCREEN_ID}"
```

---

### å‚ç›´æ‰©å±• (æå‡å•å±å¹•æ€§èƒ½)

**å¦‚æœå•ä¸ªå±å¹•è´Ÿè½½è¿‡é«˜**ï¼š
- å¢åŠ åç«¯workeræ•°é‡
- ä½¿ç”¨æ›´å¼ºçš„æ ‘è“æ´¾ï¼ˆå¦‚æ ‘è“æ´¾5ï¼‰
- ä½¿ç”¨ç‹¬ç«‹çš„GPUåŠ é€Ÿï¼ˆCoral TPUï¼‰

---

## ğŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. ç½‘ç»œå®‰å…¨
```yaml
# ä¸è¦æš´éœ²ä¸å¿…è¦çš„ç«¯å£
services:
  backend-screen1:
    ports:
      - "127.0.0.1:12393:12393"  # åªç›‘å¬æœ¬åœ°ï¼Œé€šè¿‡Nginxä»£ç†è®¿é—®
```

### 2. ä¸Šä¼ éªŒè¯
```python
# ä¸Šä¼ æœåŠ¡éœ€è¦éªŒè¯
- æ–‡ä»¶å¤§å°é™åˆ¶
- æ–‡ä»¶ç±»å‹ç™½åå•
- ç—…æ¯’æ‰«æï¼ˆClamAVï¼‰
- ç”¨æˆ·èº«ä»½éªŒè¯ï¼ˆå¯é€‰ï¼‰
```

### 3. APIå¯†é’¥ä¿æŠ¤
```yaml
# ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–Docker Secrets
services:
  backend-screen1:
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}  # ä».envæ–‡ä»¶è¯»å–
    secrets:
      - openai_key

secrets:
  openai_key:
    file: ./secrets/openai_key.txt
```

---

## ğŸ“Š æ¨èçš„éƒ¨ç½²æ‹“æ‰‘

### æ–¹æ¡ˆA: å•å°æœåŠ¡å™¨ (é€‚åˆå°è§„æ¨¡ 1-3å±)
```
æ ‘è“æ´¾ (8GB)
â”œâ”€â”€ Docker + Portainer
â”œâ”€â”€ å±å¹•1å®¹å™¨ç»„ (2GB)
â”œâ”€â”€ å±å¹•2å®¹å™¨ç»„ (2GB)
â”œâ”€â”€ å±å¹•3å®¹å™¨ç»„ (2GB)
â”œâ”€â”€ ä¸Šä¼ æœåŠ¡ (512MB)
â”œâ”€â”€ Nginx (128MB)
â””â”€â”€ Portainer (128MB)
æ€»è®¡: ~6.8GB (ç•™1GBç³»ç»Ÿä½™é‡)
```

### æ–¹æ¡ˆB: å¤šå°æ ‘è“æ´¾ (é€‚åˆå¤§è§„æ¨¡ 4+å±)
```
æ ‘è“æ´¾1 (ä¸»èŠ‚ç‚¹)
â”œâ”€â”€ Portainer Server
â”œâ”€â”€ ä¸Šä¼ æœåŠ¡
â”œâ”€â”€ Nginx
â””â”€â”€ å±å¹•1-2å®¹å™¨ç»„

æ ‘è“æ´¾2 (å·¥ä½œèŠ‚ç‚¹)
â””â”€â”€ å±å¹•3-4å®¹å™¨ç»„

æ ‘è“æ´¾3 (å·¥ä½œèŠ‚ç‚¹)
â””â”€â”€ å±å¹•5-6å®¹å™¨ç»„
```

**ä½¿ç”¨Docker Swarmç®¡ç†å¤šèŠ‚ç‚¹**ï¼ˆå¯é€‰ï¼‰

---

## ğŸ¯ æ€»ç»“ï¼šæ¶æ„è®¾è®¡è¦ç‚¹

### âœ… åšå¯¹çš„äº‹
1. **å‰åç«¯åˆ†ç¦»** - æé«˜çµæ´»æ€§
2. **æ¯å±ç‹¬ç«‹å®ä¾‹** - æ•…éšœéš”ç¦»
3. **å…±äº«å­˜å‚¨** - ç»Ÿä¸€ç®¡ç†å¹¿å‘Š
4. **åå‘ä»£ç†** - ç»Ÿä¸€å…¥å£ï¼Œæ”¯æŒSSL
5. **å®¹å™¨åŒ–éƒ¨ç½²** - æ˜“äºç®¡ç†å’Œè¿ç§»
6. **èµ„æºé™åˆ¶** - é¿å…å•ä¸ªå®¹å™¨å ç”¨è¿‡å¤šèµ„æº
7. **å¥åº·æ£€æŸ¥** - è‡ªåŠ¨é‡å¯æ•…éšœå®¹å™¨
8. **æ—¥å¿—æŒä¹…åŒ–** - æ–¹ä¾¿æ’æŸ¥é—®é¢˜

### âš ï¸ é¿å…çš„å‘
1. âŒ ä¸è¦æŠŠæ‰€æœ‰æœåŠ¡å¡åœ¨ä¸€ä¸ªå®¹å™¨é‡Œ
2. âŒ ä¸è¦æŠŠå¹¿å‘Šå­˜å‚¨åœ¨å®¹å™¨å†…éƒ¨
3. âŒ ä¸è¦å¿½ç•¥å¤‡ä»½ç­–ç•¥
4. âŒ ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒæš´éœ²æ•æ„Ÿç«¯å£
5. âŒ ä¸è¦å¿˜è®°é…ç½®è‡ªåŠ¨é‡å¯
6. âŒ ä¸è¦ä½¿ç”¨SDå¡å­˜å‚¨è§†é¢‘
7. âŒ ä¸è¦è·³è¿‡å¥åº·æ£€æŸ¥é…ç½®

---

## ğŸ“ æ¨èçš„é¡¹ç›®æ–‡ä»¶ç»“æ„ï¼ˆå¤šç§Ÿæˆ·éš”ç¦»ç‰ˆï¼‰

```
ads-system/
â”œâ”€â”€ docker-compose-screen1.yml    # CLIENT_ID=client_screen1
â”œâ”€â”€ docker-compose-screen2.yml    # CLIENT_ID=client_screen2
â”œâ”€â”€ docker-compose-screen3.yml    # CLIENT_ID=client_screen3
â”œâ”€â”€ docker-compose-caddy.yml      # åå‘ä»£ç†
â”œâ”€â”€ docker-compose-portainer.yml  # å®¹å™¨ç®¡ç†
â”œâ”€â”€ docker-compose-cloudflare.yml # å†…ç½‘ç©¿é€ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ .env                          # ç¯å¢ƒå˜é‡ï¼ˆå«S3å‡­è¯ï¼‰
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚
â”œâ”€â”€ configs/                      # é…ç½®æ–‡ä»¶ï¼ˆæŒ‰å®¢æˆ·éš”ç¦»ï¼‰
â”‚   â”œâ”€â”€ conf-screen1.yaml         # client_id: client_screen1
â”‚   â”œâ”€â”€ conf-screen2.yaml         # client_id: client_screen2
â”‚   â””â”€â”€ conf-screen3.yaml         # client_id: client_screen3
â”‚
â”œâ”€â”€ caddy/
â”‚   â””â”€â”€ Caddyfile                 # Caddyé…ç½®æ–‡ä»¶
â”‚
â”œâ”€â”€ kiosk/                        # Kioské…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ kiosk.sh                  # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ kiosk-watchdog.sh         # ç›‘æ§è„šæœ¬
â”‚   â”œâ”€â”€ install-kiosk.sh          # è‡ªåŠ¨å®‰è£…è„šæœ¬
â”‚   â””â”€â”€ README.md                 # Kioské…ç½®è¯´æ˜
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ add-screen.sh             # æ·»åŠ æ–°å±å¹•
â”‚   â”œâ”€â”€ backup.sh                 # å¤‡ä»½è„šæœ¬
â”‚   â”œâ”€â”€ health-check.sh           # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ sync-s3.sh                # S3åŒæ­¥è„šæœ¬
â”‚   â””â”€â”€ restart-all.sh            # é‡å¯æ‰€æœ‰æœåŠ¡
â”‚
â”œâ”€â”€ secrets/                      # æ•æ„Ÿä¿¡æ¯ (ä¸æäº¤Git)
â”‚   â”œâ”€â”€ openai_key.txt
â”‚   â”œâ”€â”€ s3_credentials.json       # S3è®¿é—®å‡­è¯
â”‚   â””â”€â”€ cloudflare_token.txt
â”‚
â”œâ”€â”€ cache/                        # æœ¬åœ°ç¼“å­˜ï¼ˆæŒ‰CLIENT_IDéš”ç¦»ï¼‰
â”‚   â”œâ”€â”€ client_screen1/
â”‚   â”œâ”€â”€ client_screen2/
â”‚   â””â”€â”€ client_screen3/
â”‚
â”œâ”€â”€ logs/                         # æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ screen1/
â”‚   â”œâ”€â”€ screen2/
â”‚   â””â”€â”€ screen3/
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ éƒ¨ç½²æ¶æ„è®¾è®¡æ–¹æ¡ˆ.md       # æœ¬æ–‡æ¡£
    â”œâ”€â”€ å¤šç§Ÿæˆ·èµ„æºéš”ç¦»å®æ–½æŒ‡å—.md # æ–°å¢
    â”œâ”€â”€ KIOSK_SETUP.md           # Kioské…ç½®æŒ‡å—
    â””â”€â”€ S3_STORAGE_GUIDE.md      # S3å­˜å‚¨é…ç½®æŒ‡å—
```

**è¯´æ˜**ï¼š
- âœ… å·²åˆ é™¤ `docker-compose-upload.yml`ï¼ˆä¸Šä¼ åŠŸèƒ½é›†æˆåœ¨å„åç«¯ä¸­ï¼‰
- âœ… cache ç›®å½•æŒ‰ CLIENT_ID éš”ç¦»
- âœ… é…ç½®æ–‡ä»¶ä¸­åŒ…å« client_id å­—æ®µ
- âœ… secrets åŒ…å« S3 è®¿é—®å‡­è¯

---

---

## ğŸ¬ å®Œæ•´éƒ¨ç½²æ¸…å•

### æœåŠ¡å™¨ç«¯ï¼ˆå¯ä»¥æ˜¯äº‘æœåŠ¡å™¨æˆ–æ ‘è“æ´¾ä¸»èŠ‚ç‚¹ï¼‰

```bash
# 1. å®‰è£…Dockerå’ŒDocker Compose
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# 2. å…‹éš†é¡¹ç›®
git clone https://github.com/your/ads-system.git
cd ads-system

# 3. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆåŒ…å«S3å‡­è¯ï¼‰
cp .env.example .env
nano .env  # å¡«å…¥S3å¯†é’¥ã€APIå¯†é’¥ç­‰

# ç¤ºä¾‹.envå†…å®¹ï¼š
# AWS_ACCESS_KEY=your_access_key
# AWS_SECRET_KEY=your_secret_key
# S3_BUCKET=your-ads-bucket
# S3_REGION=us-east-1
# CDN_URL=https://cdn.example.com

# 4. å¯åŠ¨æ ¸å¿ƒæœåŠ¡
docker-compose -f docker-compose-caddy.yml up -d
docker-compose -f docker-compose-portainer.yml up -d

# 5. å¯åŠ¨å±å¹•æœåŠ¡ï¼ˆæ¯ä¸ªå±å¹•ç‹¬ç«‹CLIENT_IDï¼‰
docker-compose -f docker-compose-screen1.yml up -d  # CLIENT_ID=client_screen1
docker-compose -f docker-compose-screen2.yml up -d  # CLIENT_ID=client_screen2
docker-compose -f docker-compose-screen3.yml up -d  # CLIENT_ID=client_screen3
```

### æ ‘è“æ´¾Kioskç«¯

```bash
# 1. å®‰è£…Kioskä¾èµ–
sudo apt update
sudo apt install -y xserver-xorg xinit openbox chromium-browser unclutter

# 2. å¤åˆ¶Kioské…ç½®
scp kiosk/* pi@192.168.1.101:~/

# 3. è¿è¡Œè‡ªåŠ¨å®‰è£…è„šæœ¬
ssh pi@192.168.1.101
bash ~/install-kiosk.sh

# 4. é‡å¯æ ‘è“æ´¾
sudo reboot
```

### é…ç½®åŸŸåè§£æ

```bash
# æ·»åŠ ä»¥ä¸‹Aè®°å½•åˆ°ä½ çš„DNSï¼š
screen1.example.com  â†’  æ ‘è“æ´¾å…¬ç½‘IP  # CLIENT_ID=client_screen1
screen2.example.com  â†’  æ ‘è“æ´¾å…¬ç½‘IP  # CLIENT_ID=client_screen2
screen3.example.com  â†’  æ ‘è“æ´¾å…¬ç½‘IP  # CLIENT_ID=client_screen3
admin.example.com    â†’  æ ‘è“æ´¾å…¬ç½‘IP  # Portainerç®¡ç†åå°
cdn.example.com      â†’  S3 CDNåŸŸåï¼ˆå¯é€‰ï¼Œä½¿ç”¨S3è‡ªå¸¦CDNï¼‰
```

---

## ğŸ“Š å®Œæ•´æ¶æ„å›¾ï¼ˆå¤šç§Ÿæˆ·éš”ç¦»ç‰ˆ - æœ€ç»ˆç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        äº’è”ç½‘ / ç”¨æˆ·                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   åŸŸåè§£æ   â”‚
                    â”‚ example.com â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ screen1~3.com  â”‚ â”‚ admin.com   â”‚ â”‚  cdn.com       â”‚
â”‚ (Kiosk+ä¸Šä¼ )   â”‚ â”‚ (åå°ç®¡ç†)  â”‚ â”‚ (S3/CDN)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚    Caddy    â”‚
                    â”‚  åå‘ä»£ç†    â”‚
                    â”‚  è‡ªåŠ¨HTTPS  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
  â”‚ åç«¯å®¹å™¨1  â”‚    â”‚  åç«¯å®¹å™¨2   â”‚   â”‚  åç«¯å®¹å™¨3  â”‚
  â”‚ CLIENT_ID: â”‚    â”‚  CLIENT_ID:  â”‚   â”‚  CLIENT_ID: â”‚
  â”‚ screen1   â”‚    â”‚  screen2    â”‚   â”‚  screen3    â”‚
  â”‚ (å†…ç½®ä¸Šä¼ ) â”‚    â”‚  (å†…ç½®ä¸Šä¼ )  â”‚   â”‚  (å†…ç½®ä¸Šä¼ ) â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚ S3å¯¹è±¡å­˜å‚¨   â”‚
                    â”‚å•Bucketéš”ç¦»  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
  â”‚client_    â”‚    â”‚ client_     â”‚   â”‚ client_     â”‚
  â”‚screen1/   â”‚    â”‚ screen2/    â”‚   â”‚ screen3/    â”‚
  â”‚â”œâ”€ads/     â”‚    â”‚ â”œâ”€ads/      â”‚   â”‚ â”œâ”€ads/      â”‚
  â”‚â””â”€agent/   â”‚    â”‚ â””â”€agent/    â”‚   â”‚ â””â”€agent/    â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
  â”‚ æ ‘è“æ´¾1   â”‚    â”‚  æ ‘è“æ´¾2    â”‚   â”‚  æ ‘è“æ´¾3    â”‚
  â”‚ æœ¬åœ°ç¼“å­˜   â”‚    â”‚  æœ¬åœ°ç¼“å­˜    â”‚   â”‚  æœ¬åœ°ç¼“å­˜   â”‚
  â”‚ Kioskæ¨¡å¼ â”‚    â”‚  Kioskæ¨¡å¼  â”‚   â”‚  Kioskæ¨¡å¼  â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
  â”‚  å¹¿å‘Šå±1  â”‚    â”‚   å¹¿å‘Šå±2   â”‚   â”‚   å¹¿å‘Šå±3   â”‚
  â”‚ 1920x1080 â”‚    â”‚  1920x1080  â”‚   â”‚  1920x1080  â”‚
  â”‚  å…¨å±æ˜¾ç¤º  â”‚    â”‚   å…¨å±æ˜¾ç¤º  â”‚   â”‚   å…¨å±æ˜¾ç¤º  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¶æ„ç‰¹ç‚¹**ï¼š
- âœ… æ¯ä¸ªå±å¹•ç‹¬ç«‹çš„CLIENT_IDï¼ˆclient_screen1/2/3ï¼‰
- âœ… S3å­˜å‚¨æŒ‰å‰ç¼€éš”ç¦»ï¼ˆ/client_screen1/ads, /client_screen1/agentï¼‰
- âœ… ä¸Šä¼ åŠŸèƒ½é›†æˆåœ¨åç«¯ï¼Œæ— éœ€ç‹¬ç«‹æœåŠ¡
- âœ… æ ‘è“æ´¾æœ¬åœ°ç¼“å­˜æŒ‰CLIENT_IDéš”ç¦»
- âœ… å®Œå…¨çš„å¤šç§Ÿæˆ·èµ„æºéš”ç¦»

---

## ğŸ”— ç›¸å…³æ–‡æ¡£å‚è€ƒ

### å®˜æ–¹æ–‡æ¡£
- [Docker Composeå®˜æ–¹æ–‡æ¡£](https://docs.docker.com/compose/)
- [Caddyå®˜æ–¹æ–‡æ¡£](https://caddyserver.com/docs/)
- [Portainerä½¿ç”¨æŒ‡å—](https://docs.portainer.io/)
- [æ ‘è“æ´¾å®˜æ–¹æ–‡æ¡£](https://www.raspberrypi.com/documentation/)

### äº‘å­˜å‚¨æä¾›å•†
- [é˜¿é‡Œäº‘OSS](https://help.aliyun.com/product/31815.html)
- [è…¾è®¯äº‘COS](https://cloud.tencent.com/document/product/436)
- [AWS S3](https://docs.aws.amazon.com/s3/)
- [MinIOè‡ªå»ºå¯¹è±¡å­˜å‚¨](https://min.io/docs/minio/linux/index.html)

### Kioskç›¸å…³
- [Raspberry Pi Kiosk Mode](https://www.raspberrypi.com/tutorials/how-to-use-a-raspberry-pi-in-kiosk-mode/)
- [Chromium Kiosk Mode](https://developer.chrome.com/docs/chromium/kiosk-mode/)

### å†…ç½‘ç©¿é€
- [Cloudflare Tunnel](https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/)
- [frpå†…ç½‘ç©¿é€](https://github.com/fatedier/frp)

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒä»¥ä¸‹èµ„æºï¼š
1. æŸ¥çœ‹ `logs/` ç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶
2. è®¿é—® `admin.example.com` æŸ¥çœ‹Portainerç®¡ç†ç•Œé¢
3. æ£€æŸ¥Caddyæ—¥å¿—: `docker-compose -f docker-compose-caddy.yml logs`
4. æŸ¥çœ‹äº‘å­˜å‚¨ä¸Šä¼ æƒ…å†µ: ç™»å½•OSSæ§åˆ¶å°

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0 (äº‘å­˜å‚¨ + Kiosk + Caddyå®Œæ•´ç‰ˆ)
**æœ€åæ›´æ–°**: 2025-01-17
**ç»´æŠ¤è€…**: TheProjectSan Team


