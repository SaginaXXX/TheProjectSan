# å¿«é€Ÿä¿®å¤æŒ‡å—ï¼šæ¸…ç©ºç¼“å­˜æ¢å¤è¿æ¥

> **é—®é¢˜**: WebSocket æ— æ³•è¿æ¥  
> **åŸå› **: localStorage ä¸­æœ‰æ—§çš„ç©ºå€¼é…ç½®  
> **ä¿®å¤æ—¶é—´**: 1 åˆ†é’Ÿ

---

## ğŸš€ ç«‹å³æ‰§è¡Œï¼ˆä¸‰æ­¥æå®šï¼‰

### æ­¥éª¤ 1ï¼šæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·

æŒ‰ **F12** æˆ–å³é”® â†’ æ£€æŸ¥

### æ­¥éª¤ 2ï¼šåˆ‡æ¢åˆ° Consoleï¼ˆæ§åˆ¶å°ï¼‰æ ‡ç­¾

### æ­¥éª¤ 3ï¼šå¤åˆ¶ç²˜è´´ä»¥ä¸‹å‘½ä»¤å¹¶å›è½¦

```javascript
// æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
localStorage.clear();
sessionStorage.clear();
console.log('âœ… ç¼“å­˜å·²æ¸…ç©º');

// é‡æ–°åŠ è½½é¡µé¢
location.reload();
```

---

## ğŸ“Š åŸç†è¯´æ˜

### ä¸ºä»€ä¹ˆéœ€è¦æ¸…ç©ºç¼“å­˜ï¼Ÿ

**é—®é¢˜é“¾æ¡**ï¼š

```
1. ä¹‹å‰çš„ä»£ç ä½¿ç”¨ useLocalStorage
   â””â”€ localStorage['wsUrl'] = ''  âŒ ç©ºå­—ç¬¦ä¸²

2. æˆ‘ä»¬ä¿®å¤äº†ä»£ç ï¼ŒStore ç°åœ¨æœ‰é»˜è®¤å€¼
   â””â”€ initialConfig.wsUrl = 'ws://127.0.0.1:12393/client-ws' âœ…

3. ä½† Zustand persist ä¸­é—´ä»¶ä» localStorage è¿˜åŸæ•°æ®
   â””â”€ è¯»å–åˆ°æ—§çš„ç©ºå€¼
   â””â”€ è¦†ç›–äº† Store çš„é»˜è®¤å€¼
   â””â”€ wsUrl åˆå˜æˆ '' âŒ

4. WebSocket å°è¯•è¿æ¥ç©º URL
   â””â”€ è¿æ¥å¤±è´¥ âŒ
```

### æ¸…ç©ºç¼“å­˜å

```
1. localStorage ä¸ºç©º âœ…

2. Zustand persist æ‰¾ä¸åˆ°æ—§æ•°æ®
   â””â”€ ä½¿ç”¨ Store çš„é»˜è®¤å€¼
   â””â”€ wsUrl = 'ws://127.0.0.1:12393/client-ws' âœ…

3. WebSocket è¿æ¥æˆåŠŸ âœ…

4. åŠŸèƒ½æ¢å¤æ­£å¸¸ âœ…
```

---

## âœ… éªŒè¯æˆåŠŸ

æ¸…ç©ºç¼“å­˜å¹¶åˆ·æ–°åï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```javascript
âœ… æ­£ç¡®çš„æ—¥å¿—ï¼š

1. ğŸª Zustandä¼ä¸šçº§çŠ¶æ€ç®¡ç†ç³»ç»Ÿå·²åˆå§‹åŒ–
2. ğŸŒ è‡ªåŠ¨æ£€æµ‹æœåŠ¡å™¨åœ°å€: http://localhost:12393
3. ğŸ”Œ WebSocketHandler: åˆå§‹åŒ–WebSocketè¿æ¥
4. ğŸŒ WS connecting... ws://127.0.0.1:12393/client-ws
5. âœ… WS open  â† å…³é”®ï¼åº”è¯¥çœ‹åˆ°è¿™ä¸ª
6. ğŸ©º WS heartbeat -> ping
7. åç»­æ­£å¸¸æ—¥å¿—...
```

**åŠŸèƒ½æ¢å¤**ï¼š
- âœ… Live2D æ¨¡å‹åŠ è½½
- âœ… éº¦å…‹é£å¯ç”¨
- âœ… å¯ä»¥å¯¹è¯

---

## ğŸ”§ ä¸€é”®ä¿®å¤è„šæœ¬

å¦‚æœä½ ç»å¸¸å¼€å‘ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°åˆ›å»ºå¿«æ·å‘½ä»¤ï¼š

```javascript
// ä¿å­˜åˆ°æµè§ˆå™¨ Snippets
window.clearAppCache = function() {
  localStorage.clear();
  sessionStorage.clear();
  console.log('âœ… åº”ç”¨ç¼“å­˜å·²æ¸…ç©º');
  location.reload();
};

// ä½¿ç”¨: clearAppCache()
```

---

## ğŸ”® æ°¸ä¹…ä¿®å¤

æˆ‘å·²ç»åœ¨ä»£ç ä¸­æ·»åŠ äº†é˜²æŠ¤ï¼Œä»¥åä¸ä¼šå†å‡ºç°è¿™ä¸ªé—®é¢˜ï¼š

```typescript
// âœ… Store ç°åœ¨æœ‰åˆç†çš„é»˜è®¤å€¼
const initialConfigState = {
  wsUrl: 'ws://127.0.0.1:12393/client-ws',  // æœ‰æ•ˆé»˜è®¤å€¼
  baseUrl: 'http://127.0.0.1:12393',         // æœ‰æ•ˆé»˜è®¤å€¼
};
```

**æ¸…ç©ºç¼“å­˜åï¼Œä»¥åå°±æ­£å¸¸äº†ï¼**

---

## â“ å¦‚æœæ¸…ç©ºç¼“å­˜åè¿˜æ˜¯ä¸è¡Œ

### 1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ

```bash
# ç¡®ä¿åç«¯æœåŠ¡åœ¨è¿è¡Œ
python run_server.py
```

**åº”è¯¥çœ‹åˆ°**ï¼š
```
INFO:     Uvicorn running on http://0.0.0.0:12393
```

### 2. æ£€æŸ¥ Store é…ç½®

åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
// æ£€æŸ¥ Store ä¸­çš„é…ç½®
const { useAppStore } = await import('./src/store/index.ts');
const state = useAppStore.getState();
console.log('wsUrl:', state.config.wsUrl);
console.log('baseUrl:', state.config.baseUrl);
```

**åº”è¯¥è¾“å‡º**ï¼š
```
wsUrl: ws://127.0.0.1:12393/client-ws
baseUrl: http://127.0.0.1:12393
```

### 3. æ‰‹åŠ¨è¿æ¥æµ‹è¯•

```javascript
const { wsService } = await import('./src/services/websocket-service.tsx');
wsService.connect('ws://127.0.0.1:12393/client-ws');
```

---

## ğŸ”„ ç»ˆæå›æ»šæ–¹æ¡ˆ

å¦‚æœä»¥ä¸Šéƒ½ä¸è¡Œï¼Œå›æ»šæ‰€æœ‰ä¿®æ”¹ï¼š

```bash
git status
git checkout -- frontend/src/renderer/src/
```

---

**ç«‹å³æ‰§è¡Œ**: åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ `localStorage.clear(); location.reload();`

**é¢„è®¡ç»“æœ**: ğŸŸ¢ **åº”è¯¥ç«‹å³æ¢å¤æ­£å¸¸**

