# ğŸ—ºï¸ S3é›†æˆå®æ–½è·¯çº¿å›¾

## ğŸ¯ å½“å‰çŠ¶æ€è¯„ä¼°

### âœ… å·²å®Œæˆï¼ˆ90%ï¼‰

```
å­˜å‚¨æŠ½è±¡å±‚:              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  â”œâ”€ StorageInterface    âœ… å®Œæˆ
  â”œâ”€ LocalStorage        âœ… å®Œæˆ
  â”œâ”€ S3Storage           âœ… å®Œæˆ
  â””â”€ StorageFactory      âœ… å®Œæˆ

é…ç½®ç³»ç»Ÿ:                â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  â”œâ”€ MediaServerConfig   âœ… å®Œæˆ
  â”œâ”€ S3å‚æ•°é…ç½®          âœ… å®Œæˆ
  â””â”€ CDNé…ç½®             âœ… å®Œæˆ

APIé›†æˆ:                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  â”œâ”€ /api/upload         âœ… ä½¿ç”¨storage_factory
  â”œâ”€ /api/media/list     âœ… ä½¿ç”¨storage_factory
  â””â”€ /api/media/delete   âœ… ä½¿ç”¨storage_factory

Webæ§åˆ¶é¢æ¿:             â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  â”œâ”€ å¹¿å‘Šä¸Šä¼             âœ… æ”¯æŒCLIENT_ID
  â”œâ”€ æ–‡ä»¶åˆ—è¡¨            âœ… æ”¯æŒCLIENT_ID
  â””â”€ æ–‡ä»¶åˆ é™¤            âœ… æ”¯æŒCLIENT_ID
```

### âŒ å¾…å®Œæˆï¼ˆ10%ï¼‰

```
MCPå¹¿å‘ŠæœåŠ¡å™¨:           â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  20%
  â”œâ”€ æœ¬åœ°è·¯å¾„ç¡¬ç¼–ç        âŒ éœ€è¦ä¿®æ”¹
  â”œâ”€ S3é›†æˆ              âŒ éœ€è¦å®ç°
  â””â”€ URLç”Ÿæˆ             âŒ éœ€è¦CDNæ”¯æŒ

é™æ€æ–‡ä»¶æœåŠ¡:            â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%
  â”œâ”€ S3ä»£ç†è·¯ç”±          âŒ éœ€è¦å®ç°
  â””â”€ CDNé‡å®šå‘           âŒ éœ€è¦å®ç°

é…ç½®æ–‡æ¡£:                â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  40%
  â”œâ”€ æ¶æ„æ–‡æ¡£            âœ… æœ¬æ–‡æ¡£ç³»åˆ—
  â”œâ”€ S3é…ç½®ç¤ºä¾‹          âŒ éœ€è¦åˆ›å»º
  â””â”€ éƒ¨ç½²è„šæœ¬            âŒ éœ€è¦åˆ›å»º
```

---

## ğŸ“… å®æ–½è®¡åˆ’

### é˜¶æ®µ1: MCPå¹¿å‘ŠæœåŠ¡å™¨S3æ”¯æŒï¼ˆæ ¸å¿ƒï¼‰

**æ—¶é—´**: 2-3å°æ—¶  
**ä¼˜å…ˆçº§**: ğŸ”´ **é«˜**

#### ä»»åŠ¡1.1: ä¿®æ”¹AdvertisementServeråˆå§‹åŒ–
```python
# æ–‡ä»¶: src/ai_chat/mcpp/advertisement_server.py

# âŒ å½“å‰ä»£ç 
class AdvertisementServer:
    def __init__(self, ads_dir: str = "ads", client_id: str = None):
        self.ads_dir = Path(ads_dir) / self.client_id

# âœ… ä¿®æ”¹ä¸º
class AdvertisementServer:
    def __init__(
        self, 
        media_config: MediaServerConfig,
        client_id: str = None
    ):
        """
        åˆå§‹åŒ–å¹¿å‘ŠæœåŠ¡å™¨
        
        Args:
            media_config: åª’ä½“æœåŠ¡å™¨é…ç½®ï¼ˆåŒ…å«storage_typeç­‰ï¼‰
            client_id: å®¢æˆ·ID
        """
        from ..storage.storage_factory import create_storage_service
        
        # è·å–CLIENT_ID
        self.client_id = client_id or os.getenv('CLIENT_ID') or media_config.client_id
        
        # åˆ›å»ºå­˜å‚¨æœåŠ¡ï¼ˆè‡ªåŠ¨é€‰æ‹©æœ¬åœ°/S3ï¼‰
        self.storage_service = create_storage_service(
            config=media_config,
            client_id=self.client_id
        )
        
        self.media_config = media_config
        self.advertisements = {}
```

#### ä»»åŠ¡1.2: ä¿®æ”¹_scan_advertisementsæ–¹æ³•
```python
# âŒ å½“å‰ä»£ç 
def _scan_advertisements(self):
    for file_path in self.ads_dir.iterdir():
        # æ‰«ææœ¬åœ°æ–‡ä»¶

# âœ… ä¿®æ”¹ä¸º
async def _scan_advertisements(self):
    """
    æ‰«æå¹¿å‘Šè§†é¢‘ï¼ˆæ”¯æŒæœ¬åœ°å’ŒS3ï¼‰
    """
    try:
        # ä½¿ç”¨storage_serviceç»Ÿä¸€æ¥å£
        files = await self.storage_service.list_files(category="ads")
        
        ad_count = 0
        for file_info in files:
            ad_id = f"ad_{ad_count:03d}"
            
            # æ„å»ºå¹¿å‘Šä¿¡æ¯
            ad_info = {
                "id": ad_id,
                "name": Path(file_info["filename"]).stem,
                "filename": file_info["filename"],
                "size_bytes": file_info["size_bytes"],
                "size_mb": file_info["size_mb"],
                "format": Path(file_info["filename"]).suffix.lower(),
                
                # âœ… ä½¿ç”¨storage_serviceç”ŸæˆURLï¼ˆè‡ªåŠ¨é€‚é…æœ¬åœ°/CDNï¼‰
                "url": self.storage_service.get_file_url("ads", file_info["filename"]),
                
                "category": "advertisement",
                "client_id": self.client_id
            }
            
            self.advertisements[ad_id] = ad_info
            ad_count += 1
            print(f"âœ… [{self.client_id}] {ad_info['name']} ({ad_info['size_mb']} MB)")
        
        self.stats["total_ads"] = len(self.advertisements)
        print(f"\nğŸ¬ å¹¿å‘ŠæœåŠ¡å™¨åˆå§‹åŒ–å®Œæˆ: {len(self.advertisements)} ä¸ªå¹¿å‘Šå·²åŠ è½½")
        
    except Exception as e:
        print(f"âŒ æ‰«æå¹¿å‘Šå¤±è´¥: {e}")
        self.advertisements = {}
```

#### ä»»åŠ¡1.3: ä¿®æ”¹refreshå·¥å…·
```python
# âœ… ä¿®æ”¹refreshå·¥å…·æ”¯æŒS3
@server.call_tool()
async def handle_call_tool(name: str, arguments: dict):
    if name == "refresh":
        # é‡æ–°æ‰«æï¼ˆæ”¯æŒS3ï¼‰
        await self._scan_advertisements()
        
        return [TextContent(
            type="text",
            text=json.dumps({
                "success": True,
                "total_ads": len(self.advertisements),
                "message": "å¹¿å‘Šåˆ—è¡¨å·²åˆ·æ–°ï¼ˆä»S3åŠ è½½ï¼‰"
            })
        )]
```

#### ä»»åŠ¡1.4: ä¿®æ”¹mcp_servers.json
```json
{
  "mcpServers": {
    "advertisement-server": {
      "command": "python",
      "args": ["-m", "src.ai_chat.mcpp.advertisement_server"],
      "env": {
        "CLIENT_ID": "client_001",
        "PYTHONPATH": "."
      }
    }
  }
}
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… MCPæœåŠ¡å™¨èƒ½ä»S3åŠ è½½å¹¿å‘Šåˆ—è¡¨
- âœ… get_advertisement_playlistè¿”å›CDN URL
- âœ… refreshå·¥å…·èƒ½åˆ·æ–°S3å¹¿å‘Š
- âœ… æœ¬åœ°æ¨¡å¼ä»èƒ½æ­£å¸¸å·¥ä½œ

---

### é˜¶æ®µ2: é™æ€æ–‡ä»¶æœåŠ¡S3ä»£ç†ï¼ˆå¯é€‰ï¼‰

**æ—¶é—´**: 1å°æ—¶  
**ä¼˜å…ˆçº§**: ğŸŸ¡ **ä¸­**ï¼ˆå¦‚æœä½¿ç”¨CDNç›´é“¾å¯è·³è¿‡ï¼‰

#### æ–¹æ¡ˆA: S3ä»£ç†è·¯ç”±ï¼ˆæ¨èæœ¬åœ°å¼€å‘ï¼‰

```python
# æ–‡ä»¶: src/ai_chat/routes.py

@router.get("/ads/{client_id}/{filename}")
async def serve_advertisement(client_id: str, filename: str):
    """
    å¹¿å‘Šæ–‡ä»¶æœåŠ¡ï¼ˆæ”¯æŒæœ¬åœ°å’ŒS3ï¼‰
    
    æœ¬åœ°æ¨¡å¼: è¿”å›æœ¬åœ°æ–‡ä»¶
    S3æ¨¡å¼: é‡å®šå‘åˆ°CDN/S3 URL
    """
    from .storage.storage_factory import create_storage_service
    from fastapi.responses import FileResponse, RedirectResponse
    
    media_config = default_context_cache.config.system_config.media_server
    storage_service = create_storage_service(media_config, client_id=client_id)
    
    if media_config.storage_type == "s3":
        # S3æ¨¡å¼: é‡å®šå‘åˆ°CDN
        cdn_url = storage_service.get_file_url("ads", filename)
        logger.info(f"ğŸ“¡ é‡å®šå‘åˆ°CDN: {cdn_url}")
        return RedirectResponse(url=cdn_url, status_code=307)
    else:
        # æœ¬åœ°æ¨¡å¼: è¿”å›æ–‡ä»¶
        file_path = Path(f"ads/{client_id}/{filename}")
        if not file_path.exists():
            return Response(status_code=404)
        return FileResponse(file_path)

# åŒæ ·ä¸ºagentèµ„æºæ·»åŠ 
@router.get("/agent/{client_id}/{filename}")
async def serve_agent_resource(client_id: str, filename: str):
    # å®ç°ç±»ä¼¼
    pass
```

#### æ–¹æ¡ˆB: å‰ç«¯ç›´æ¥ä½¿ç”¨CDN URLï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

```typescript
// frontend/src/renderer/src/hooks/use-mcp-handler.ts

// âœ… ç›´æ¥ä½¿ç”¨APIè¿”å›çš„å®Œæ•´URL
const advertisement = {
    filename: "video.mp4",
    url: "https://cdn.example.com/client_001/ads/video.mp4"  // å®Œæ•´URL
};

// æ’­æ”¾å™¨ç›´æ¥ä½¿ç”¨
<video src={advertisement.url} />
// æ— éœ€æ‹¼æ¥ï¼Œç›´æ¥è®¿é—®CDN
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… S3æ¨¡å¼ä¸‹è§†é¢‘èƒ½æ­£å¸¸æ’­æ”¾
- âœ… æœ¬åœ°æ¨¡å¼ä»èƒ½æ­£å¸¸å·¥ä½œ
- âœ… CDN URLèƒ½è¢«æµè§ˆå™¨æ­£ç¡®è®¿é—®

---

### é˜¶æ®µ3: é…ç½®å’Œæ–‡æ¡£å®Œå–„

**æ—¶é—´**: 1-2å°æ—¶  
**ä¼˜å…ˆçº§**: ğŸŸ¢ **ä½**

#### ä»»åŠ¡3.1: åˆ›å»ºS3é…ç½®ç¤ºä¾‹

**æ–‡ä»¶**: `conf.s3.example.yaml`
```yaml
# S3å­˜å‚¨é…ç½®ç¤ºä¾‹
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º conf.yaml å¹¶å¡«å†™æ‚¨çš„S3ä¿¡æ¯

system_config:
  host: "0.0.0.0"
  port: 12393
  
  media_server:
    # ==================== S3å­˜å‚¨é…ç½® ====================
    storage_type: "s3"                    # åˆ‡æ¢åˆ°S3æ¨¡å¼
    client_id: "client_001"               # æ‚¨çš„å®¢æˆ·ID
    
    # S3æ¡¶é…ç½®
    s3_bucket: "your-bucket-name"         # æ›¿æ¢ä¸ºæ‚¨çš„æ¡¶å
    s3_region: "us-east-1"                # æ›¿æ¢ä¸ºæ‚¨çš„åŒºåŸŸ
    
    # S3å‡­è¯ï¼ˆæ¨èä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œä¸è¦å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼‰
    # s3_access_key: "YOUR_ACCESS_KEY"    # ç•™ç©ºï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡
    # s3_secret_key: "YOUR_SECRET_KEY"    # ç•™ç©ºï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡
    
    # CDNé…ç½®ï¼ˆå¯é€‰ä½†å¼ºçƒˆæ¨èï¼‰
    cdn_url: "https://cdn.example.com"    # æ‚¨çš„CDNåŸŸå
    
    # ç¼“å­˜é…ç½®ï¼ˆS3æ¨¡å¼ä»å¯ä½¿ç”¨æœ¬åœ°ç¼“å­˜åŠ é€Ÿï¼‰
    cache_enabled: true
    cache_dir: "cache"
    cache_size_limit: "10GB"
  
  # å…¶ä»–é…ç½®...
  config_alts_dir: "characters"

character_config:
  # è§’è‰²é…ç½®...
```

#### ä»»åŠ¡3.2: åˆ›å»ºç¯å¢ƒå˜é‡ç¤ºä¾‹

**æ–‡ä»¶**: `.env.s3.example`
```bash
# ==================== S3å­˜å‚¨ç¯å¢ƒå˜é‡ç¤ºä¾‹ ====================
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º .env å¹¶å¡«å†™æ‚¨çš„å®é™…å€¼

# ==================== ç§Ÿæˆ·é…ç½® ====================
CLIENT_ID=client_001

# ==================== S3å‡­è¯ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼‰====================
# AWSæ–¹å¼
AWS_ACCESS_KEY=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

# æˆ–ä½¿ç”¨æ ‡å‡†AWSç¯å¢ƒå˜é‡
# AWS_ACCESS_KEY_ID=xxx
# AWS_SECRET_ACCESS_KEY=xxx

# ==================== S3é…ç½® ====================
STORAGE_TYPE=s3
S3_BUCKET=your-bucket-name
S3_REGION=us-east-1

# ==================== CDNé…ç½® ====================
CDN_URL=https://cdn.example.com

# ==================== åŸŸåé…ç½® ====================
# ç‹¬ç«‹åŸŸåæ¨¡å¼
DOMAIN=screen1.example.com

# æˆ–å…±äº«åŸŸå+è·¯å¾„æ¨¡å¼
# SHARED_DOMAIN=ads.xyz
# CLIENT_PATH=client1

# ==================== å®‰å…¨é…ç½® ====================
# å®¢æˆ·ç™½åå•ï¼ˆå¯é€‰ï¼Œé€—å·åˆ†éš”ï¼‰
VALID_CLIENTS=client_001,client_002,client_003

# ==================== å…¶ä»–é…ç½® ====================
LOG_LEVEL=INFO
PYTHONUNBUFFERED=1
```

#### ä»»åŠ¡3.3: åˆ›å»ºéƒ¨ç½²è„šæœ¬

**æ–‡ä»¶**: `deploy_s3.sh`
```bash
#!/bin/bash
# S3æ¨¡å¼å¿«é€Ÿéƒ¨ç½²è„šæœ¬

set -e

echo "ğŸš€ å¼€å§‹éƒ¨ç½² S3 æ¨¡å¼..."

# 1. æ£€æŸ¥ä¾èµ–
echo "ğŸ“¦ æ£€æŸ¥ä¾èµ–..."
if ! command -v docker &> /dev/null; then
    echo "âŒ Dockeræœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker"
    exit 1
fi

if ! command -v docker-compose &> /dev/null; then
    echo "âŒ Docker Composeæœªå®‰è£…"
    exit 1
fi

# 2. æ£€æŸ¥ç¯å¢ƒå˜é‡
echo "ğŸ” æ£€æŸ¥ç¯å¢ƒå˜é‡..."
if [ -z "$AWS_ACCESS_KEY" ] || [ -z "$AWS_SECRET_KEY" ]; then
    echo "âŒ è¯·è®¾ç½®AWSå‡­è¯ç¯å¢ƒå˜é‡"
    echo "   export AWS_ACCESS_KEY=xxx"
    echo "   export AWS_SECRET_KEY=xxx"
    exit 1
fi

# 3. åˆ›å»ºå¿…è¦ç›®å½•
echo "ğŸ“ åˆ›å»ºç›®å½•..."
mkdir -p cache/client_001 cache/client_002 cache/client_003
mkdir -p logs/client_001 logs/client_002 logs/client_003
mkdir -p caddy_data caddy_config

# 4. æ£€æŸ¥é…ç½®æ–‡ä»¶
echo "âš™ï¸ æ£€æŸ¥é…ç½®æ–‡ä»¶..."
if [ ! -f "conf.yaml" ]; then
    echo "âŒ conf.yamlä¸å­˜åœ¨"
    exit 1
fi

# 5. æµ‹è¯•S3è¿æ¥
echo "â˜ï¸ æµ‹è¯•S3è¿æ¥..."
python3 << EOF
import boto3
import os

try:
    s3 = boto3.client(
        's3',
        aws_access_key_id=os.getenv('AWS_ACCESS_KEY'),
        aws_secret_access_key=os.getenv('AWS_SECRET_KEY')
    )
    s3.list_buckets()
    print("âœ… S3è¿æ¥æˆåŠŸ")
except Exception as e:
    print(f"âŒ S3è¿æ¥å¤±è´¥: {e}")
    exit(1)
EOF

# 6. æ„å»ºé•œåƒ
echo "ğŸ—ï¸ æ„å»ºDockeré•œåƒ..."
docker-compose build

# 7. å¯åŠ¨å®¹å™¨
echo "ğŸš€ å¯åŠ¨å®¹å™¨..."
docker-compose up -d

# 8. ç­‰å¾…æœåŠ¡å°±ç»ª
echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 10

# 9. å¥åº·æ£€æŸ¥
echo "ğŸ¥ å¥åº·æ£€æŸ¥..."
for port in 12393 12394 12395; do
    if curl -f http://localhost:$port/health &> /dev/null; then
        echo "âœ… ç«¯å£ $port å¥åº·"
    else
        echo "âŒ ç«¯å£ $port ä¸å¥åº·"
    fi
done

# 10. æ˜¾ç¤ºçŠ¶æ€
echo ""
echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo ""
echo "ğŸ“Š å®¹å™¨çŠ¶æ€:"
docker-compose ps
echo ""
echo "ğŸŒ è®¿é—®åœ°å€:"
echo "  - æ˜Ÿå·´å…‹: http://localhost:12393/"
echo "  - éº¦å½“åŠ³: http://localhost:12394/"
echo "  - è‚¯å¾·åŸº: http://localhost:12395/"
echo ""
echo "ğŸ“± Webæ§åˆ¶é¢æ¿:"
echo "  - http://localhost:12393/web-tool/control-panel.html?client=client_001"
echo ""
echo "ğŸ“ æŸ¥çœ‹æ—¥å¿—:"
echo "  docker-compose logs -f screen_client001"
```

---

### é˜¶æ®µ2: Agentèµ„æºä¸Šä¼ ï¼ˆæœªæ¥ï¼‰

**æ—¶é—´**: 4-6å°æ—¶  
**ä¼˜å…ˆçº§**: ğŸŸ¡ **ä¸­**

#### ä»»åŠ¡æ¸…å•
- [ ] åˆ›å»º`agent_resource_server.py`
- [ ] å®ç°`upload_image`å·¥å…·
- [ ] å®ç°`upload_video`å·¥å…·
- [ ] å®ç°`list_agent_resources`å·¥å…·
- [ ] å‰ç«¯æ·»åŠ å›¾ç‰‡/è§†é¢‘æ˜¾ç¤ºç»„ä»¶
- [ ] æ›´æ–°Agent Promptï¼ˆæ·»åŠ å·¥å…·ä½¿ç”¨è¯´æ˜ï¼‰
- [ ] æµ‹è¯•å®Œæ•´æµç¨‹

---

### é˜¶æ®µ3: é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

**æ—¶é—´**: 8-10å°æ—¶  
**ä¼˜å…ˆçº§**: ğŸŸ¢ **ä½**

#### åŠŸèƒ½åˆ—è¡¨
- [ ] S3é¢„ç­¾åURLï¼ˆç§æœ‰æ¡¶æ”¯æŒï¼‰
- [ ] å¤šåŒºåŸŸS3è‡ªåŠ¨é€‰æ‹©
- [ ] CloudFrontç¼“å­˜å¤±æ•ˆAPI
- [ ] è‡ªåŠ¨è§†é¢‘è½¬ç ï¼ˆFFmpegï¼‰
- [ ] ç¼©ç•¥å›¾è‡ªåŠ¨ç”Ÿæˆ
- [ ] æ™ºèƒ½æœ¬åœ°ç¼“å­˜ï¼ˆS3â†’æœ¬åœ°ï¼‰
- [ ] ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- [ ] æ–­ç‚¹ç»­ä¼ æ”¯æŒ

---

## ğŸ› ï¸ å®æ–½æ­¥éª¤ï¼ˆè¯¦ç»†ï¼‰

### ç¬¬1å¤©: MCPå¹¿å‘ŠæœåŠ¡å™¨ï¼ˆæ ¸å¿ƒï¼‰

#### ä¸Šåˆï¼ˆ2å°æ—¶ï¼‰

**9:00-10:00 ä¿®æ”¹advertisement_server.py**
```bash
# 1. ä¿®æ”¹__init__æ–¹æ³•
# 2. ä¿®æ”¹_scan_advertisementsæ–¹æ³•
# 3. æµ‹è¯•æœ¬åœ°æ¨¡å¼å…¼å®¹æ€§
pytest tests/test_advertisement_server_local.py
```

**10:00-11:00 æµ‹è¯•S3æ¨¡å¼**
```bash
# 1. é…ç½®S3å‡­è¯
export AWS_ACCESS_KEY=xxx
export AWS_SECRET_KEY=xxx

# 2. ä¿®æ”¹conf.yaml
storage_type: "s3"

# 3. ä¸Šä¼ æµ‹è¯•æ–‡ä»¶åˆ°S3
aws s3 cp test.mp4 s3://my-bucket/client_001/ads/

# 4. å¯åŠ¨æœåŠ¡å™¨ï¼Œæµ‹è¯•MCP
python run_server.py --verbose

# 5. è°ƒç”¨MCP refreshå·¥å…·
# åº”è¯¥èƒ½ä»S3åŠ è½½å¹¿å‘Š
```

#### ä¸‹åˆï¼ˆ1å°æ—¶ï¼‰

**13:00-14:00 é›†æˆæµ‹è¯•**
```bash
# 1. Webæ§åˆ¶é¢æ¿ä¸Šä¼ æµ‹è¯•
curl -F "file=@test.mp4" \
     -F "category=ads" \
     -F "client=client_001" \
     http://localhost:12393/api/upload

# 2. æ£€æŸ¥S3æ˜¯å¦ä¸Šä¼ æˆåŠŸ
aws s3 ls s3://my-bucket/client_001/ads/

# 3. åˆ·æ–°MCPå¹¿å‘Šåˆ—è¡¨
# å‰ç«¯åº”è¯¥èƒ½çœ‹åˆ°æ–°ä¸Šä¼ çš„è§†é¢‘

# 4. æ’­æ”¾æµ‹è¯•
# å‰ç«¯æ’­æ”¾CDN URLçš„è§†é¢‘
```

---

### ç¬¬2å¤©: é™æ€æ–‡ä»¶ä»£ç†ï¼ˆå¯é€‰ï¼‰

#### ä¸Šåˆï¼ˆ1å°æ—¶ï¼‰

**9:00-10:00 æ·»åŠ ä»£ç†è·¯ç”±**
```python
# routes.py
@router.get("/ads/{client_id}/{filename}")
async def serve_ad(client_id: str, filename: str):
    # å®ç°ä»£ç†é€»è¾‘
    pass

# æµ‹è¯•
curl -I http://localhost:12393/ads/client_001/test.mp4
# åº”è¯¥è¿”å›: 307 Redirect åˆ° CDN URL
```

---

### ç¬¬3å¤©: æ–‡æ¡£å’Œéƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

#### ä¸Šåˆï¼ˆ2å°æ—¶ï¼‰

**9:00-11:00 å®Œå–„æ–‡æ¡£**
- âœ… åˆ›å»ºS3é…ç½®ç¤ºä¾‹
- âœ… åˆ›å»ºéƒ¨ç½²è„šæœ¬
- âœ… æ›´æ–°README
- âœ… ç¼–å†™æ•…éšœæ’é™¤æŒ‡å—

#### ä¸‹åˆï¼ˆ2å°æ—¶ï¼‰

**13:00-15:00 ç”Ÿäº§éƒ¨ç½²**
```bash
# 1. é…ç½®ç”Ÿäº§ç¯å¢ƒ
vim .env.production

# 2. éƒ¨ç½²åˆ°æœåŠ¡å™¨
scp -r . user@server:/opt/ai-screen/
ssh user@server "cd /opt/ai-screen && ./deploy_s3.sh"

# 3. é…ç½®åŸŸå
# ä¿®æ”¹DNSè®°å½•

# 4. æµ‹è¯•è®¿é—®
curl https://screen1.example.com/api/health
```

---

## ğŸ“Š æ—¶é—´çº¿æ€»è§ˆ

```
Week 1:
â”œâ”€ Day 1: MCPå¹¿å‘ŠæœåŠ¡å™¨S3æ”¯æŒ        [æ ¸å¿ƒ] ğŸ”´
â”‚  â”œâ”€ ä¸Šåˆ: ä¿®æ”¹ä»£ç  (2h)
â”‚  â””â”€ ä¸‹åˆ: æµ‹è¯•éªŒè¯ (2h)
â”‚
â”œâ”€ Day 2: é™æ€æ–‡ä»¶ä»£ç†              [å¯é€‰] ğŸŸ¡
â”‚  â””â”€ ä¸Šåˆ: å®ç°è·¯ç”± (1h)
â”‚
â”œâ”€ Day 3: æ–‡æ¡£å’Œéƒ¨ç½²                [å¯é€‰] ğŸŸ¢
â”‚  â”œâ”€ ä¸Šåˆ: å®Œå–„æ–‡æ¡£ (2h)
â”‚  â””â”€ ä¸‹åˆ: ç”Ÿäº§éƒ¨ç½² (2h)
â”‚
â””â”€ Day 4-5: Agentèµ„æºä¸Šä¼            [æœªæ¥] ğŸ”µ
   â””â”€ éœ€è¦æ—¶å†å®æ–½

æ€»å·¥ä½œé‡: æ ¸å¿ƒåŠŸèƒ½ 4å°æ—¶
          å®Œæ•´åŠŸèƒ½ 10å°æ—¶
```

---

## ğŸ¯ æœ€å°å¯è¡Œäº§å“ï¼ˆMVPï¼‰

å¦‚æœæ—¶é—´ç´§è¿«ï¼Œåªéœ€å®Œæˆ**é˜¶æ®µ1**å³å¯ï¼š

### MVPèŒƒå›´
- âœ… MCPå¹¿å‘ŠæœåŠ¡å™¨S3æ”¯æŒ
- âœ… Webæ§åˆ¶é¢æ¿ä¸Šä¼ åˆ°S3
- âœ… å‰ç«¯ä»CDNæ’­æ”¾è§†é¢‘
- âœ… åŸºç¡€é…ç½®æ–‡æ¡£

### MVPéªŒæ”¶æ ‡å‡†
```bash
# 1. ä¸Šä¼ æµ‹è¯•
curl -F "file=@test.mp4" http://localhost:12393/api/upload?client=client_001
# è¿”å›: {"success": true, "url": "https://cdn.example.com/..."}

# 2. åˆ—è¡¨æµ‹è¯•
curl http://localhost:12393/api/media/list?category=ads&client=client_001
# è¿”å›: {"files": [...]}  # åŒ…å«S3ä¸­çš„æ–‡ä»¶

# 3. MCPæµ‹è¯•
# å‰ç«¯è°ƒç”¨ get_advertisement_playlist
# è¿”å›çš„URLåº”è¯¥æ˜¯CDN URL

# 4. æ’­æ”¾æµ‹è¯•
# å‰ç«¯èƒ½æ­£å¸¸æ’­æ”¾CDNè§†é¢‘
```

**ä¼°è®¡**: âœ… 4å°æ—¶å®ŒæˆMVP

---

## ğŸš¦ ä¼˜å…ˆçº§çŸ©é˜µ

```
             â”‚  ç´§æ€¥         â”‚  ä¸ç´§æ€¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             â”‚               â”‚
  é‡è¦       â”‚  ğŸ”´ P0        â”‚  ğŸŸ¡ P1
             â”‚  MCP S3æ”¯æŒ   â”‚  æ–‡æ¡£å®Œå–„
             â”‚  (ç«‹å³å®æ–½)    â”‚  (æœ¬å‘¨å®Œæˆ)
             â”‚               â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             â”‚               â”‚
  ä¸é‡è¦     â”‚  ğŸŸ¢ P2        â”‚  ğŸ”µ P3
             â”‚  é™æ€ä»£ç†      â”‚  Agentèµ„æº
             â”‚  (å¯è·³è¿‡)     â”‚  (æœªæ¥è€ƒè™‘)
             â”‚               â”‚
```

### ä¼˜å…ˆçº§è¯´æ˜

**ğŸ”´ P0 - MCPå¹¿å‘ŠæœåŠ¡å™¨S3æ”¯æŒ**
- **å½±å“**: æ²¡æœ‰æ­¤åŠŸèƒ½ï¼ŒS3æ¨¡å¼å®Œå…¨æ— æ³•ä½¿ç”¨
- **å·¥ä½œé‡**: 2-3å°æ—¶
- **å»ºè®®**: ç«‹å³å®æ–½

**ğŸŸ¡ P1 - æ–‡æ¡£å’Œé…ç½®**
- **å½±å“**: å½±å“éƒ¨ç½²æ•ˆç‡å’Œå¯ç»´æŠ¤æ€§
- **å·¥ä½œé‡**: 1-2å°æ—¶
- **å»ºè®®**: æœ¬å‘¨å®Œæˆ

**ğŸŸ¢ P2 - é™æ€æ–‡ä»¶ä»£ç†**
- **å½±å“**: å¦‚æœä½¿ç”¨CDNç›´é“¾å¯è·³è¿‡
- **å·¥ä½œé‡**: 1å°æ—¶
- **å»ºè®®**: å¯é€‰å®æ–½

**ğŸ”µ P3 - Agentèµ„æºä¸Šä¼ **
- **å½±å“**: å¢å¼ºå¯¹è¯ä½“éªŒï¼Œéå¿…éœ€
- **å·¥ä½œé‡**: 4-6å°æ—¶
- **å»ºè®®**: æœªæ¥è€ƒè™‘

---

## ğŸ¯ å®æ–½å»ºè®®

### æ¨èè·¯å¾„

#### è·¯å¾„A: æœ€å¿«ä¸Šçº¿ï¼ˆ4å°æ—¶ï¼‰
```
Day 1 ä¸Šåˆ:
  âœ… ä¿®æ”¹MCPå¹¿å‘ŠæœåŠ¡å™¨ (2h)
  âœ… æµ‹è¯•æœ¬åœ°æ¨¡å¼å…¼å®¹æ€§

Day 1 ä¸‹åˆ:
  âœ… æµ‹è¯•S3æ¨¡å¼ (1h)
  âœ… ç®€å•æ–‡æ¡£ (1h)
  
âœ… æ€»è®¡: 4å°æ—¶
âœ… è¦†ç›–ç‡: 80%æ ¸å¿ƒåŠŸèƒ½
```

#### è·¯å¾„B: å®Œæ•´å®æ–½ï¼ˆ10å°æ—¶ï¼‰
```
Day 1:
  âœ… ä¿®æ”¹MCPå¹¿å‘ŠæœåŠ¡å™¨ (3h)
  âœ… æµ‹è¯•ä¸¤ç§æ¨¡å¼ (1h)

Day 2:
  âœ… é™æ€æ–‡ä»¶ä»£ç† (1h)
  âœ… å‰ç«¯URLå¤„ç† (1h)
  âœ… é›†æˆæµ‹è¯• (2h)

Day 3:
  âœ… å®Œå–„æ–‡æ¡£ (2h)
  
âœ… æ€»è®¡: 10å°æ—¶
âœ… è¦†ç›–ç‡: 100%å½“å‰åŠŸèƒ½
```

#### è·¯å¾„C: æ¸è¿›å¼ï¼ˆåˆ†é˜¶æ®µï¼‰
```
Sprint 1 (æœ¬å‘¨):
  âœ… MCP S3æ”¯æŒ (æ ¸å¿ƒ)
  âœ… åŸºç¡€æ–‡æ¡£

Sprint 2 (ä¸‹å‘¨):
  âœ… é™æ€æ–‡ä»¶ä»£ç†
  âœ… éƒ¨ç½²è„šæœ¬

Sprint 3 (ä¸‹ä¸‹å‘¨):
  âœ… Agentèµ„æºä¸Šä¼ 
  âœ… é«˜çº§åŠŸèƒ½

âœ… æ¸è¿›å¼è¿­ä»£ï¼Œé£é™©æœ€å°
```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### å¼€å‘ç¯å¢ƒæµ‹è¯•

- [ ] æœ¬åœ°æ¨¡å¼èƒ½æ­£å¸¸è¿è¡Œ
- [ ] S3æ¨¡å¼èƒ½æ­£å¸¸è¿è¡Œ
- [ ] ä¸¤ç§æ¨¡å¼å¯ä»¥åˆ‡æ¢
- [ ] Webæ§åˆ¶é¢æ¿ä¸Šä¼ æˆåŠŸ
- [ ] MCPèƒ½ä»S3åŠ è½½åˆ—è¡¨
- [ ] å‰ç«¯èƒ½æ’­æ”¾CDNè§†é¢‘
- [ ] åˆ é™¤åŠŸèƒ½æ­£å¸¸
- [ ] åˆ·æ–°åŠŸèƒ½æ­£å¸¸

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

- [ ] S3æ¡¶å·²åˆ›å»ºå¹¶é…ç½®
- [ ] IAMç”¨æˆ·å’Œæƒé™å·²è®¾ç½®
- [ ] CDNå·²é…ç½®å¹¶æµ‹è¯•
- [ ] åŸŸåå·²è§£æ
- [ ] SSLè¯ä¹¦å·²é…ç½®
- [ ] Dockeré•œåƒå·²æ„å»º
- [ ] å®¹å™¨å·²å¯åŠ¨
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] æ—¥å¿—æ­£å¸¸è¾“å‡º
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡

### å®‰å…¨æ£€æŸ¥

- [ ] S3æ¡¶æƒé™æ­£ç¡®ï¼ˆæœ€å°æƒé™åŸåˆ™ï¼‰
- [ ] IAMç”¨æˆ·åªèƒ½è®¿é—®æŒ‡å®šèµ„æº
- [ ] CLIENT_IDç™½åå•å·²é…ç½®
- [ ] HTTPSå·²å¯ç”¨
- [ ] CORSé…ç½®æ­£ç¡®
- [ ] æ–‡ä»¶å¤§å°é™åˆ¶å·²è®¾ç½®
- [ ] æ–‡ä»¶ç±»å‹éªŒè¯å·²å¯ç”¨

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒç»“è®º

1. **å½“å‰çŠ¶æ€**: 90%å®Œæˆï¼Œæ¶æ„å·²å°±ç»ª
2. **æ ¸å¿ƒå·®è·**: MCPå¹¿å‘ŠæœåŠ¡å™¨S3æ”¯æŒ
3. **æœ€å°å·¥ä½œé‡**: 4å°æ—¶å®ŒæˆMVP
4. **æ¨èè·¯å¾„**: å…ˆå®æ–½æ ¸å¿ƒï¼Œå†æ¸è¿›ä¼˜åŒ–

### ç«‹å³è¡ŒåŠ¨

**å¦‚æœåªæœ‰4å°æ—¶**:
1. ä¿®æ”¹`advertisement_server.py`ï¼ˆ2å°æ—¶ï¼‰
2. æµ‹è¯•æœ¬åœ°+S3æ¨¡å¼ï¼ˆ1å°æ—¶ï¼‰
3. ç¼–å†™åŸºç¡€æ–‡æ¡£ï¼ˆ1å°æ—¶ï¼‰
âœ… å®Œæˆ80%æ ¸å¿ƒåŠŸèƒ½

**å¦‚æœæœ‰10å°æ—¶**:
1. å®Œæˆä¸Šè¿°4å°æ—¶ä»»åŠ¡
2. æ·»åŠ é™æ€æ–‡ä»¶ä»£ç†ï¼ˆ1å°æ—¶ï¼‰
3. å‰ç«¯URLå¤„ç†ï¼ˆ1å°æ—¶ï¼‰
4. å®Œæ•´é›†æˆæµ‹è¯•ï¼ˆ2å°æ—¶ï¼‰
5. å®Œå–„æ–‡æ¡£å’Œè„šæœ¬ï¼ˆ2å°æ—¶ï¼‰
âœ… å®Œæˆ100%å½“å‰åŠŸèƒ½

**æœªæ¥æ‰©å±•**:
- Agentèµ„æºä¸Šä¼ ï¼ˆéœ€è¦æ—¶å†åšï¼‰
- é«˜çº§åŠŸèƒ½ï¼ˆæŒ‰éœ€å®æ–½ï¼‰

---

**ä¸‹ä¸€ç¯‡**: [07-å¸¸è§é—®é¢˜FAQ](./07-å¸¸è§é—®é¢˜FAQ.md)

