# ğŸ“¹ å¹¿å‘Šè§†é¢‘S3ä¸Šä¼ è¯¦è§£

## ğŸ¯ å¹¿å‘Šè§†é¢‘ä¸Šä¼ æµç¨‹

### å®Œæ•´æµç¨‹å›¾

```mermaid
sequenceDiagram
    participant åº—é•¿ as ğŸ“± åº—é•¿æ‰‹æœº
    participant Web as ğŸŒ Webæ§åˆ¶é¢æ¿
    participant API as ğŸš€ FastAPI Backend
    participant Factory as ğŸ­ Storage Factory
    participant S3 as â˜ï¸ AWS S3/é˜¿é‡Œäº‘OSS
    participant CDN as ğŸš€ CDN
    participant MCP as ğŸ¬ MCPå¹¿å‘ŠæœåŠ¡å™¨
    participant å‰ç«¯ as ğŸ–¥ï¸ æ ‘è“æ´¾å‰ç«¯

    Note over åº—é•¿: æ‰«æå¹¿å‘Šå±æ—çš„äºŒç»´ç 
    åº—é•¿->>Web: æ‰“å¼€æ§åˆ¶é¢æ¿<br/>URL: ads.xyz/web-tool/control-panel.html?client=client_001
    
    Note over Web: æ˜¾ç¤ºåª’ä½“ç®¡ç†ç•Œé¢
    åº—é•¿->>Web: é€‰æ‹©å¹¿å‘Šè§†é¢‘<br/>coffee_promo.mp4 (50MB)
    
    Web->>API: POST /api/upload<br/>FormData: file, category=ads, client=client_001
    
    Note over API: æ­¥éª¤1: éªŒè¯CLIENT_ID
    API->>API: client_id = client_001<br/>(æ¥è‡ªAPIå‚æ•°)
    
    Note over API: æ­¥éª¤2: éªŒè¯æ–‡ä»¶
    API->>API: æ£€æŸ¥æ–‡ä»¶ç±»å‹: .mp4 âœ…<br/>æ£€æŸ¥æ–‡ä»¶å¤§å°: 50MB < 500MB âœ…
    
    Note over API: æ­¥éª¤3: åˆ›å»ºå­˜å‚¨æœåŠ¡
    API->>Factory: create_storage_service(config, "client_001")
    
    alt storage_type = "s3"
        Factory-->>API: è¿”å› S3StorageService
        
        Note over API: æ­¥éª¤4: ç”Ÿæˆæ–‡ä»¶å
        API->>API: filename = coffee_promo_1730000000.mp4<br/>(åŸå_æ—¶é—´æˆ³.æ‰©å±•å)
        
        Note over API: æ­¥éª¤5: ä¸Šä¼ åˆ°S3
        API->>S3: put_object(<br/>  Bucket: "my-ads-bucket",<br/>  Key: "client_001/ads/coffee_promo_1730000000.mp4",<br/>  Body: file_data,<br/>  ContentType: "video/mp4"<br/>)
        
        S3-->>API: ä¸Šä¼ æˆåŠŸ<br/>è¿”å› ETag
        
        Note over API: æ­¥éª¤6: ç”Ÿæˆè®¿é—®URL
        API->>S3: get_file_url("ads", filename)
        
        alt é…ç½®äº†CDN
            S3-->>API: https://cdn.example.com/client_001/ads/coffee_promo_1730000000.mp4
        else ç›´æ¥S3 URL
            S3-->>API: https://my-ads-bucket.s3.us-east-1.amazonaws.com/client_001/ads/coffee_promo_1730000000.mp4
        end
    else storage_type = "local"
        Factory-->>API: è¿”å› LocalStorageService
        API->>API: å†™å…¥æ–‡ä»¶åˆ°<br/>ads/client_001/coffee_promo_1730000000.mp4
        API-->>API: http://localhost:12393/ads/client_001/coffee_promo_1730000000.mp4
    end
    
    Note over API: æ­¥éª¤7: å¹¿æ’­åˆ·æ–°é€šçŸ¥
    API->>MCP: WebSocketå¹¿æ’­<br/>{ type: "advertisement-refresh", action: "uploaded" }
    
    API-->>Web: è¿”å›æˆåŠŸ<br/>{ success: true, url: "https://cdn.../...", filename: "..." }
    
    Web-->>åº—é•¿: âœ… ä¸Šä¼ æˆåŠŸï¼
    
    Note over MCP: ç›‘å¬åˆ°åˆ·æ–°é€šçŸ¥
    MCP->>S3: list_objects_v2<br/>Prefix: "client_001/ads/"
    S3-->>MCP: è¿”å›æ–‡ä»¶åˆ—è¡¨ï¼ˆåŒ…å«æ–°ä¸Šä¼ çš„è§†é¢‘ï¼‰
    
    MCP->>MCP: æ›´æ–°å¹¿å‘Šæ’­æ”¾åˆ—è¡¨
    MCP->>å‰ç«¯: MCPæ¶ˆæ¯: æ–°å¹¿å‘Šåˆ—è¡¨
    
    Note over å‰ç«¯: è‡ªåŠ¨åˆ·æ–°æ’­æ”¾åˆ—è¡¨
    å‰ç«¯->>CDN: GET https://cdn.example.com/client_001/ads/coffee_promo_1730000000.mp4
    CDN-->>å‰ç«¯: è¿”å›è§†é¢‘æµ
    
    Note over å‰ç«¯: å¼€å§‹æ’­æ”¾æ–°å¹¿å‘Š
```

---

## ğŸ” CLIENT_ID éš”ç¦»æœºåˆ¶

### ä¸Šä¼ éš”ç¦»

ä¸åŒå®¢æˆ·çš„å¹¿å‘Šè§†é¢‘ä¸Šä¼ åˆ°ç‹¬ç«‹çš„S3å‰ç¼€ï¼ˆç›¸å½“äºç›®å½•ï¼‰ï¼š

```
s3://my-ads-bucket/
â”œâ”€ client_001/                    # æ˜Ÿå·´å…‹
â”‚  â””â”€ ads/
â”‚     â”œâ”€ coffee_promo.mp4         â† åº—é•¿Aä¸Šä¼ 
â”‚     â”œâ”€ summer_special.mp4       â† åº—é•¿Aä¸Šä¼ 
â”‚     â””â”€ morning_deal.mp4         â† åº—é•¿Aä¸Šä¼ 
â”‚
â”œâ”€ client_002/                    # éº¦å½“åŠ³
â”‚  â””â”€ ads/
â”‚     â”œâ”€ burger_ad.mp4            â† åº—é•¿Bä¸Šä¼ 
â”‚     â””â”€ breakfast_menu.mp4       â† åº—é•¿Bä¸Šä¼ 
â”‚
â””â”€ client_003/                    # è‚¯å¾·åŸº
   â””â”€ ads/
      â””â”€ chicken_combo.mp4        â† åº—é•¿Cä¸Šä¼ 
```

**éš”ç¦»ä¿è¯**:
- âœ… åº—é•¿Aæ‰«çš„äºŒç»´ç å¸¦ `?client=client_001`ï¼Œåªèƒ½ä¸Šä¼ åˆ° `client_001/ads/`
- âœ… åº—é•¿Bæ‰«çš„äºŒç»´ç å¸¦ `?client=client_002`ï¼Œåªèƒ½ä¸Šä¼ åˆ° `client_002/ads/`
- âŒ åº—é•¿Aæ— æ³•è®¿é—®æˆ–ä¿®æ”¹ `client_002/` æˆ– `client_003/` çš„æ–‡ä»¶

---

## ğŸ“ ä»£ç å®ç°è¯¦è§£

### åç«¯ä¸Šä¼ API

```python
# src/ai_chat/routes.py

@router.post("/api/upload")
async def upload_media(
    file: UploadFile = File(...),
    category: str = Form("ads"),          # åˆ†ç±»: ads=å¹¿å‘Š, agent=Agentèµ„æº
    client: Optional[str] = Form(None)    # CLIENT_ID (å¯é€‰)
):
    """
    é€šç”¨åª’ä½“ä¸Šä¼ æ¥å£
    
    æ”¯æŒ:
    - æœ¬åœ°å­˜å‚¨ / S3äº‘å­˜å‚¨ (è‡ªåŠ¨åˆ‡æ¢)
    - å¤šç§Ÿæˆ·éš”ç¦» (CLIENT_ID)
    - æ–‡ä»¶éªŒè¯ (ç±»å‹/å¤§å°)
    - WebSocketåˆ·æ–°é€šçŸ¥
    """
    try:
        from .storage.storage_factory import create_storage_service
        import time
        
        # ==================== æ­¥éª¤1: è·å–CLIENT_ID ====================
        media_config = default_context_cache.config.system_config.media_server
        
        # ä¼˜å…ˆçº§: APIå‚æ•° > ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼
        container_client_id = os.getenv('CLIENT_ID')     # Dockerå®¹å™¨
        config_client_id = media_config.client_id        # conf.yaml
        
        client_id = (
            client                      # 1. APIå‚æ•° (Webæ§åˆ¶é¢æ¿ä¼ å…¥)
            or container_client_id      # 2. ç¯å¢ƒå˜é‡ (Dockeréƒ¨ç½²)
            or config_client_id         # 3. é…ç½®æ–‡ä»¶ (æœ¬åœ°å¼€å‘)
            or 'default_client'         # 4. é»˜è®¤å€¼
        )
        
        logger.info(f"ğŸ“¤ æ”¶åˆ°ä¸Šä¼ è¯·æ±‚ - CLIENT_ID: {client_id}, Category: {category}")
        
        # ==================== æ­¥éª¤2: éªŒè¯CLIENT_ID ====================
        # æ ¼å¼éªŒè¯
        if not client_id.startswith('client_'):
            return Response(
                content=json.dumps({"error": "æ— æ•ˆçš„CLIENT_IDæ ¼å¼"}),
                status_code=400,
                media_type="application/json"
            )
        
        # ç™½åå•éªŒè¯ï¼ˆå¯é€‰ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨ï¼‰
        valid_clients = os.getenv('VALID_CLIENTS', '')
        if valid_clients:
            valid_list = [c.strip() for c in valid_clients.split(',')]
            if client_id not in valid_list:
                logger.warning(f"âŒ CLIENT_ID {client_id} æœªæˆæƒ")
                return Response(
                    content=json.dumps({"error": "CLIENT_IDæœªæˆæƒ"}),
                    status_code=403,
                    media_type="application/json"
                )
        
        # ==================== æ­¥éª¤3: éªŒè¯æ–‡ä»¶ ====================
        # è¯»å–æ–‡ä»¶å†…å®¹
        contents = await file.read()
        file_size = len(contents)
        file_ext = Path(file.filename).suffix.lower()
        
        # æ–‡ä»¶ç±»å‹éªŒè¯
        ALLOWED_VIDEO_EXTS = {'.mp4', '.avi', '.mov', '.webm', '.mkv'}
        ALLOWED_IMAGE_EXTS = {'.jpg', '.jpeg', '.png', '.gif'}
        
        if category == 'ads':
            # å¹¿å‘Šåªå…è®¸è§†é¢‘
            if file_ext not in ALLOWED_VIDEO_EXTS:
                return Response(
                    content=json.dumps({
                        "error": f"ä¸æ”¯æŒçš„è§†é¢‘æ ¼å¼: {file_ext}",
                        "allowed": list(ALLOWED_VIDEO_EXTS)
                    }),
                    status_code=400,
                    media_type="application/json"
                )
        elif category == 'agent':
            # Agentèµ„æºå…è®¸å›¾ç‰‡å’Œè§†é¢‘
            if file_ext not in (ALLOWED_VIDEO_EXTS | ALLOWED_IMAGE_EXTS):
                return Response(
                    content=json.dumps({
                        "error": f"ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: {file_ext}"
                    }),
                    status_code=400,
                    media_type="application/json"
                )
        
        # æ–‡ä»¶å¤§å°éªŒè¯
        MAX_SIZE = 500 * 1024 * 1024  # 500MB
        if file_size > MAX_SIZE:
            return Response(
                content=json.dumps({
                    "error": f"æ–‡ä»¶è¿‡å¤§: {file_size / (1024*1024):.2f}MB, æœ€å¤§å…è®¸: 500MB"
                }),
                status_code=400,
                media_type="application/json"
            )
        
        logger.info(f"âœ… æ–‡ä»¶éªŒè¯é€šè¿‡ - å¤§å°: {file_size/(1024*1024):.2f}MB, æ ¼å¼: {file_ext}")
        
        # ==================== æ­¥éª¤4: ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å ====================
        original_name = Path(file.filename).stem
        timestamp = int(time.time())
        filename = f"{original_name}_{timestamp}{file_ext}"
        
        # ==================== æ­¥éª¤5: åˆ›å»ºå­˜å‚¨æœåŠ¡ ====================
        # å·¥å‚æ¨¡å¼è‡ªåŠ¨åˆ›å»º LocalStorageService æˆ– S3StorageService
        storage_service = create_storage_service(
            config=media_config,
            client_id=client_id
        )
        
        logger.info(f"ğŸ“¦ ä½¿ç”¨å­˜å‚¨æœåŠ¡: {storage_service.__class__.__name__}")
        
        # ==================== æ­¥éª¤6: ä¸Šä¼ æ–‡ä»¶ ====================
        # ç»Ÿä¸€æ¥å£ï¼Œè‡ªåŠ¨é€‚é…æœ¬åœ°/S3
        storage_path = await storage_service.upload_file(
            file_data=contents,
            category=category,
            filename=filename
        )
        
        # è·å–è®¿é—®URL
        file_url = storage_service.get_file_url(category, filename)
        
        logger.info(f"âœ… ä¸Šä¼ æˆåŠŸ - è·¯å¾„: {storage_path}, URL: {file_url}")
        
        # ==================== æ­¥éª¤7: å¹¿æ’­åˆ·æ–°é€šçŸ¥ ====================
        if category == 'ads' and websocket_handler:
            try:
                # é€šçŸ¥æ‰€æœ‰å‰ç«¯åˆ·æ–°å¹¿å‘Šåˆ—è¡¨
                refresh_message = {
                    "type": "advertisement-refresh",
                    "action": "uploaded",
                    "filename": filename,
                    "client_id": client_id
                }
                
                # å¼‚æ­¥å¹¿æ’­ï¼ˆä¸é˜»å¡å“åº”ï¼‰
                asyncio.create_task(
                    websocket_handler.broadcast_settings_update(
                        refresh_message,
                        ["advertisement"]
                    )
                )
                
                logger.info(f"ğŸ“¡ å·²å‘é€å¹¿å‘Šåˆ·æ–°é€šçŸ¥")
            except Exception as e:
                logger.warning(f"å¹¿æ’­åˆ·æ–°å¤±è´¥: {e}")
        
        # ==================== æ­¥éª¤8: è¿”å›ç»“æœ ====================
        return {
            "success": True,
            "message": "ä¸Šä¼ æˆåŠŸ",
            "filename": filename,
            "original_name": file.filename,
            "storage_path": storage_path,
            "url": file_url,
            "size_bytes": file_size,
            "size_mb": round(file_size / (1024 * 1024), 2),
            "category": category,
            "client_id": client_id,
            "timestamp": timestamp
        }
        
    except Exception as e:
        logger.error(f"âŒ ä¸Šä¼ å¤±è´¥: {e}", exc_info=True)
        return Response(
            content=json.dumps({"error": f"ä¸Šä¼ å¤±è´¥: {str(e)}"}),
            status_code=500,
            media_type="application/json"
        )
```

---

## ğŸ¨ å‰ç«¯ä¸Šä¼ ç•Œé¢

### Webæ§åˆ¶é¢æ¿ä¸Šä¼ 

```html
<!-- web_tool/control-panel.html -->

<div class="upload-area" id="mediaUploadArea">
    <div class="upload-icon">ğŸ“¤</div>
    <div>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤åŒºåŸŸä¸Šä¼ </div>
    <div style="font-size: 14px; color: #666; margin-top: 8px;">
        æ”¯æŒæ ¼å¼: MP4, AVI, MOV, WEBM<br>
        æœ€å¤§å¤§å°: 500MB
    </div>
</div>
<input type="file" id="mediaFileInput" accept="video/*" multiple>
```

```javascript
// ä¸Šä¼ å¤„ç†
async function uploadMediaFiles(fileList) {
    const statusDiv = document.getElementById('mediaUploadStatus');
    statusDiv.innerHTML = '<div class="loading">ä¸Šä¼ ä¸­...</div>';
    
    try {
        let successCount = 0;
        
        for (let i = 0; i < fileList.length; i++) {
            const file = fileList[i];
            const formData = new FormData();
            formData.append('file', file);
            formData.append('client', currentClientId);  // å½“å‰å®¢æˆ·ID
            formData.append('category', 'ads');          // å¹¿å‘Šåˆ†ç±»
            
            const response = await fetch('/api/upload', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const result = await response.json();
                console.log('ä¸Šä¼ æˆåŠŸ:', result);
                successCount++;
            }
        }
        
        statusDiv.innerHTML = `<div class="alert-success">ä¸Šä¼ æˆåŠŸï¼ä¸Šä¼ äº† ${successCount} ä¸ªæ–‡ä»¶ã€‚</div>`;
        
        // é‡æ–°åŠ è½½æ–‡ä»¶åˆ—è¡¨
        loadMediaFiles();
        
    } catch (error) {
        statusDiv.innerHTML = `<div class="alert-error">ä¸Šä¼ å¤±è´¥: ${error.message}</div>`;
    }
}
```

---

## ğŸ“Š S3å­˜å‚¨ç»“æ„

### Bucketç»„ç»‡æ–¹å¼

```
s3://my-advertisement-bucket/
â”‚
â”œâ”€ client_001/                          # æ˜Ÿå·´å…‹ï¼ˆCLIENT_IDéš”ç¦»ï¼‰
â”‚  â”œâ”€ ads/                              # å¹¿å‘Šè§†é¢‘ç›®å½•
â”‚  â”‚  â”œâ”€ coffee_promo_1730000000.mp4   # å’–å•¡ä¿ƒé”€å¹¿å‘Š
â”‚  â”‚  â”œâ”€ summer_special_1730000100.mp4 # å¤æ—¥ç‰¹é¥®å¹¿å‘Š
â”‚  â”‚  â””â”€ morning_deal_1730000200.mp4   # æ—©é¤ä¼˜æƒ å¹¿å‘Š
â”‚  â”‚
â”‚  â””â”€ agent/                            # Agentèµ„æºç›®å½•ï¼ˆæœªæ¥ï¼‰
â”‚     â”œâ”€ menu_1730000300.jpg           # èœå•å›¾ç‰‡
â”‚     â””â”€ store_map_1730000400.png      # åº—é“ºåœ°å›¾
â”‚
â”œâ”€ client_002/                          # éº¦å½“åŠ³
â”‚  â”œâ”€ ads/
â”‚  â”‚  â”œâ”€ burger_ad_1730001000.mp4
â”‚  â”‚  â””â”€ breakfast_menu_1730001100.mp4
â”‚  â”‚
â”‚  â””â”€ agent/
â”‚     â””â”€ product_image_1730001200.jpg
â”‚
â””â”€ client_003/                          # è‚¯å¾·åŸº
   â”œâ”€ ads/
   â”‚  â””â”€ chicken_combo_1730002000.mp4
   â”‚
   â””â”€ agent/
      â””â”€ coupon_1730002100.jpg
```

### S3 Object Metadata

æ¯ä¸ªä¸Šä¼ çš„æ–‡ä»¶éƒ½ä¼šåŒ…å«ä»¥ä¸‹å…ƒæ•°æ®ï¼š

```python
{
    "Key": "client_001/ads/coffee_promo_1730000000.mp4",
    "Size": 52428800,  # 50MB
    "LastModified": "2024-10-27T10:00:00Z",
    "ContentType": "video/mp4",
    "Metadata": {
        "original-filename": "coffee_promo.mp4",
        "client-id": "client_001",
        "category": "ads",
        "uploaded-by": "web-panel",
        "upload-timestamp": "1730000000"
    },
    "StorageClass": "STANDARD"  # æˆ– INTELLIGENT_TIERING
}
```

---

## ğŸš€ CDNåŠ é€Ÿé…ç½®

### CloudFronté…ç½®ç¤ºä¾‹

```yaml
# CloudFront Distribution
Domain: cdn.example.com
Origin: my-advertisement-bucket.s3.us-east-1.amazonaws.com
Path Pattern: *
Viewer Protocol: Redirect HTTP to HTTPS
Allowed Methods: GET, HEAD, OPTIONS
Cached Methods: GET, HEAD
TTL:
  Min: 0
  Default: 86400     # 1å¤©
  Max: 31536000      # 1å¹´

# ç¼“å­˜ç­–ç•¥
Cache Key:
  - Query Strings: None
  - Headers: None
  - Cookies: None

# å‹ç¼©
Compress Objects: Yes
```

### è®¿é—®URLç¤ºä¾‹

```
åŸå§‹S3 URL:
https://my-advertisement-bucket.s3.us-east-1.amazonaws.com/client_001/ads/coffee_promo_1730000000.mp4

CDN URL:
https://cdn.example.com/client_001/ads/coffee_promo_1730000000.mp4

ä¼˜åŠ¿:
âœ… æ›´çŸ­çš„URL
âœ… å…¨çƒåŠ é€Ÿ
âœ… é™ä½S3è¯·æ±‚æˆæœ¬
âœ… è‡ªåŠ¨HTTPS
âœ… è‡ªåŠ¨å‹ç¼©
```

---

## ğŸ”„ åˆ·æ–°åŒæ­¥æœºåˆ¶

### WebSocketå¹¿æ’­æµç¨‹

```mermaid
sequenceDiagram
    participant API as FastAPI
    participant WS as WebSocket Handler
    participant å‰ç«¯1 as æ ‘è“æ´¾1 (client_001)
    participant å‰ç«¯2 as æ ‘è“æ´¾2 (client_002)
    participant MCP1 as MCP Server (client_001)
    participant MCP2 as MCP Server (client_002)

    Note over API: æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
    API->>WS: broadcast_settings_update(<br/>  { type: "advertisement-refresh",<br/>    action: "uploaded",<br/>    client_id: "client_001" }<br/>)
    
    WS->>å‰ç«¯1: WebSocketæ¶ˆæ¯<br/>{ type: "advertisement-refresh" }
    WS->>å‰ç«¯2: WebSocketæ¶ˆæ¯<br/>{ type: "advertisement-refresh" }
    
    Note over å‰ç«¯1: æ¥æ”¶åˆ°åˆ·æ–°é€šçŸ¥
    å‰ç«¯1->>MCP1: è°ƒç”¨ MCP refresh å·¥å…·
    MCP1->>MCP1: é‡æ–°æ‰«æ S3: client_001/ads/
    MCP1-->>å‰ç«¯1: è¿”å›æ–°çš„æ’­æ”¾åˆ—è¡¨
    
    Note over å‰ç«¯1: æ›´æ–°æœ¬åœ°æ’­æ”¾åˆ—è¡¨
    Note over å‰ç«¯1: ä¸‹æ¬¡åˆ‡æ¢æ—¶æ’­æ”¾æ–°å¹¿å‘Š
    
    Note over å‰ç«¯2: æ¥æ”¶åˆ°åˆ·æ–°é€šçŸ¥
    Note over å‰ç«¯2: CLIENT_IDä¸åŒ¹é…ï¼Œå¿½ç•¥
    Note over å‰ç«¯2: (client_002çš„è§†é¢‘æ²¡æœ‰æ›´æ–°)
```

### å‰ç«¯åˆ·æ–°å¤„ç†

```typescript
// frontend/src/renderer/src/services/websocket-handler.tsx

case "advertisement-refresh":
    console.log("ğŸ“¡ æ”¶åˆ°å¹¿å‘Šåˆ·æ–°é€šçŸ¥:", message);
    
    // è·å–å½“å‰CLIENT_ID
    const currentClientId = import.meta.env.VITE_CLIENT_ID || 'default_client';
    
    // åªåˆ·æ–°åŒ¹é…çš„CLIENT_ID
    if (message.client_id === currentClientId) {
        console.log("âœ… CLIENT_IDåŒ¹é…ï¼Œè§¦å‘MCPåˆ·æ–°");
        
        // è°ƒç”¨MCPåˆ·æ–°å·¥å…·
        await mcpClient.callTool({
            name: "refresh",
            arguments: {}
        });
        
        console.log("âœ… å¹¿å‘Šåˆ—è¡¨å·²åˆ·æ–°");
    } else {
        console.log("â­ï¸ CLIENT_IDä¸åŒ¹é…ï¼Œè·³è¿‡åˆ·æ–°");
    }
    break;
```

---

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### ä¸Šä¼ æ—¥å¿—ç¤ºä¾‹

```
2024-10-27 10:00:00 INFO ğŸ“¤ æ”¶åˆ°ä¸Šä¼ è¯·æ±‚ - CLIENT_ID: client_001, Category: ads
2024-10-27 10:00:01 INFO âœ… æ–‡ä»¶éªŒè¯é€šè¿‡ - å¤§å°: 50.00MB, æ ¼å¼: .mp4
2024-10-27 10:00:01 INFO ğŸ“¦ ä½¿ç”¨å­˜å‚¨æœåŠ¡: S3StorageService
2024-10-27 10:00:05 INFO â˜ï¸ S3ä¸Šä¼ ä¸­ - Key: client_001/ads/coffee_promo_1730000000.mp4
2024-10-27 10:00:10 INFO âœ… S3ä¸Šä¼ æˆåŠŸ - ETag: "d41d8cd98f00b204e9800998ecf8427e"
2024-10-27 10:00:10 INFO âœ… ä¸Šä¼ æˆåŠŸ - è·¯å¾„: client_001/ads/coffee_promo_1730000000.mp4
2024-10-27 10:00:10 INFO âœ… CDN URL: https://cdn.example.com/client_001/ads/coffee_promo_1730000000.mp4
2024-10-27 10:00:10 INFO ğŸ“¡ å·²å‘é€å¹¿å‘Šåˆ·æ–°é€šçŸ¥
```

---

## ğŸ¯ æ€»ç»“

### å…³é”®ç‰¹æ€§

1. **ç»Ÿä¸€æ¥å£** - æœ¬åœ°å’ŒS3ä½¿ç”¨ç›¸åŒçš„ä¸Šä¼ API
2. **CLIENT_IDéš”ç¦»** - æ¯ä¸ªå®¢æˆ·çš„è§†é¢‘å®Œå…¨éš”ç¦»
3. **æ–‡ä»¶éªŒè¯** - ç±»å‹ã€å¤§å°ã€æ ¼å¼å…¨é¢æ£€æŸ¥
4. **å®æ—¶åˆ·æ–°** - WebSocketè‡ªåŠ¨é€šçŸ¥å‰ç«¯æ›´æ–°
5. **CDNåŠ é€Ÿ** - å…¨çƒå¿«é€Ÿè®¿é—®

### ä¼˜åŠ¿

- âœ… åº—é•¿æ‰‹æœºç›´æ¥ä¸Šä¼ ï¼Œæ— éœ€æŠ€æœ¯äººå‘˜
- âœ… è‡ªåŠ¨å¤šç§Ÿæˆ·éš”ç¦»ï¼Œæ•°æ®å®‰å…¨
- âœ… S3æ— é™å®¹é‡ï¼Œä¸æ‹…å¿ƒç£ç›˜æ»¡
- âœ… CDNåŠ é€Ÿï¼Œæ’­æ”¾æµç•…
- âœ… å®æ—¶åˆ·æ–°ï¼Œä¸Šä¼ å³ç”Ÿæ•ˆ

---

**ä¸‹ä¸€ç¯‡**: [03-Agentèµ„æºåŠ¨æ€ä¸Šä¼ ï¼ˆæœªæ¥ï¼‰](./03-Agentèµ„æºåŠ¨æ€ä¸Šä¼ .md)

