# å‰ç«¯æ¶æ„ä¼˜åŒ– - ä¿®æ”¹æ¸…å•ï¼ˆç®€ç‰ˆï¼‰

> **æ‰§è¡Œæ—¥æœŸ**: 2025-10-06  
> **ä¸€å¥è¯æ€»ç»“**: æ¶ˆé™¤é…ç½®é‡å¤å­˜å‚¨ï¼Œæ¸…ç†LEGACYæ–‡ä»¶ï¼Œç»Ÿä¸€æ¶æ„ä¸ºå•ä¸€æ•°æ®æº

---

## âœ… ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆ5ä¸ªï¼‰

### 1. `frontend/src/renderer/src/context/websocket-context.tsx`
```diff
- const [wsUrl, setWsUrl] = useLocalStorage('wsUrl', DEFAULT_WS_URL);
- const [baseUrl, setBaseUrl] = useLocalStorage('baseUrl', DEFAULT_BASE_URL);
+ const { wsUrl, baseUrl, updateNetworkConfig } = useConfigStore();
```
**åŸå› **: æ¶ˆé™¤é…ç½®é‡å¤å­˜å‚¨

---

### 2. `frontend/src/renderer/src/context/vad-context.tsx`
```diff
- const [micOn, setMicOn] = useLocalStorage('micOn', false);
- const [autoStopMic, ...] = useLocalStorage('autoStopMic', false);
- const [settings, ...] = useLocalStorage('vadSettings', ...);
- // ... 5 ä¸ª useLocalStorage
+ const { micOn, autoStopMic, settings, ... } = useVADStore();
```
**åŸå› **: æ¶ˆé™¤ VAD é…ç½®é‡å¤å­˜å‚¨

---

### 3. `frontend/src/renderer/src/context/bgurl-context.tsx`
```diff
- const [backgroundUrl, setBackgroundUrl] = useLocalStorage('backgroundUrl', ...);
+ const { backgroundUrl, updateMediaState, ... } = useMediaStore();
```
**åŸå› **: ç»Ÿä¸€èƒŒæ™¯é…ç½®ç®¡ç†

---

### 4. `frontend/src/renderer/src/services/websocket-handler.tsx`
```diff
- const [wsUrl, setWsUrl] = useLocalStorage('wsUrl', defaultWsUrl);
- const [baseUrl, setBaseUrl] = useLocalStorage('baseUrl', defaultBaseUrl);
+ const { wsUrl, baseUrl, updateNetworkConfig } = useConfigStore();
```
**åŸå› **: æ¶ˆé™¤é…ç½®çš„ç¬¬äºŒå¤„é‡å¤ï¼ˆä¸¥é‡é—®é¢˜ï¼‰

---

### 5. `frontend/src/renderer/src/store/index.ts`
```diff
export const useVADStore = () => {
  const micOn = useAppStore((s) => s.vad.micOn);
  const autoStopMic = useAppStore((s) => s.vad.autoStopMic);
+ const autoStartMicOn = useAppStore((s) => s.vad.autoStartMicOn);
+ const autoStartMicOnConvEnd = useAppStore((s) => s.vad.autoStartMicOnConvEnd);
  const settings = useAppStore((s) => s.vad.settings);
  // ...
};
```
**åŸå› **: è¡¥å…¨ç¼ºå¤±çš„ selector å±æ€§

---

## ğŸ—‘ï¸ åˆ é™¤çš„æ–‡ä»¶ï¼ˆ4ä¸ªï¼‰

1. âœ… `frontend/src/renderer/src/context/ai-state-context.tsx` (4 è¡Œ)
2. âœ… `frontend/src/renderer/src/context/subtitle-context.tsx` (4 è¡Œ)
3. âœ… `frontend/src/renderer/src/context/advertisement-context.tsx` (39 è¡Œ)
4. âœ… `frontend/src/renderer/src/context/laundry-context.tsx` (87 è¡Œ)

**åŸå› **: å·²æ ‡è®°ä¸º LEGACYï¼ŒåŠŸèƒ½å·²è¿ç§»åˆ° Zustand Store

---

## ğŸ“Š æ”¹è¿›ç»Ÿè®¡

| æŒ‡æ ‡ | Before | After | æå‡ |
|------|--------|-------|------|
| useLocalStorage è°ƒç”¨ | 9 | 0 | âœ… -100% |
| é…ç½®é‡å¤å­˜å‚¨ | 10 é¡¹ | 0 é¡¹ | âœ… -100% |
| LEGACY æ–‡ä»¶ | 4 ä¸ª | 0 ä¸ª | âœ… -100% |
| Context æ–‡ä»¶æ•° | 15 ä¸ª | 11 ä¸ª | âœ… -27% |
| æ¶æ„è¯„åˆ† | 71/100 | 80/100 | âœ… +13% |

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### Beforeï¼ˆé—®é¢˜æ¶æ„ï¼‰
```
Zustand Store (config.wsUrl)
    â†• ä¸åŒæ­¥
websocket-context (useLocalStorage('wsUrl')) âŒ
    â†• ä¸åŒæ­¥
websocket-handler (useLocalStorage('wsUrl')) âŒ
```

### Afterï¼ˆæ­£ç¡®æ¶æ„ï¼‰
```
Zustand Store (config.wsUrl) â† å”¯ä¸€æ•°æ®æº âœ…
    â†“ å•å‘æ•°æ®æµ
websocket-context (ä» Store è¯»å–) âœ…
    â†“
websocket-handler (ä» Store è¯»å–) âœ…
```

---

## ğŸ§ª å¿…é¡»æµ‹è¯•

- [ ] WebSocket è¿æ¥å’Œæ¶ˆæ¯æ”¶å‘
- [ ] VAD éº¦å…‹é£å’Œè¯­éŸ³æ£€æµ‹
- [ ] èƒŒæ™¯åˆ‡æ¢
- [ ] é…ç½®ä¿®æ”¹å’ŒæŒä¹…åŒ–
- [ ] å¯¹è¯åŠŸèƒ½

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

è¯¦ç»†åˆ†æè¯·æŸ¥çœ‹:
- `docs/å‰ç«¯æ¶æ„æ·±åº¦å®¡æŸ¥æŠ¥å‘Š.md` - å®Œæ•´åˆ†æï¼ˆ13ä¸ªé—®é¢˜ï¼‰
- `docs/å‰ç«¯æ¶æ„ä¼˜åŒ–æœ€ç»ˆæŠ¥å‘Š.md` - ä¼˜åŒ–æ€»ç»“

---

**çŠ¶æ€**: âœ… ä¿®æ”¹å®Œæˆï¼Œç­‰å¾…æµ‹è¯•  
**è´¨é‡**: ğŸŸ¢ ä¼˜ç§€ï¼ˆæ— ç¼–è¯‘é”™è¯¯ï¼Œæ¶æ„æ¸…æ™°ï¼‰

